/*!
 * @sp-editor/editor version 1.0.0
 * Author: Capricorncd
 * Released under the MIT License
 * Repository: https://github.com/capricorncd/zx-editor
 * Copyright © 2018-present, Capricorncd/ Xing Zhong.
 */
(function(a,d){typeof exports=="object"&&typeof module<"u"?d(exports):typeof define=="function"&&define.amd?define(["exports"],d):(a=typeof globalThis<"u"?globalThis:a||self,d(a.Editor={}))})(this,function(a){"use strict";var ie=Object.defineProperty;var se=(a,d,m)=>d in a?ie(a,d,{enumerable:!0,configurable:!0,writable:!0,value:m}):a[d]=m;var p=(a,d,m)=>(se(a,typeof d!="symbol"?d+"":d,m),m);class d{constructor(){this._events={}}on(r,t){return!r||!t||typeof t!="function"?this:(this._events[r]||(this._events[r]=[]),this._events[r].push(t),this)}once(r,t){const n=(...s)=>{t.apply(this,s),this.off(r,n)};return this.on(r,n)}emit(r,...t){const n=this._events[r];if(!n)return this;for(let s=0;s<n.length;s++)try{n[s].apply(this,t)}catch(i){this.emit("error",i,"emit")}return this}off(r,t){if(!this._events[r])return this;const n=this._events[r];if(typeof t=="function"){const s=n.findIndex(i=>i===t);s>=0&&n.splice(s,1)}else this._events[r].length=0;return this._removeEmpty(r),this}_removeEmpty(r){this._events[r].length||delete this._events[r]}removeAllListeners(){Object.keys(this._events).forEach(r=>this.off(r))}}/*!
 * zx-sml version 0.7.5
 * Author: Capricorncd <capricorncd@qq.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2023-05-17 20:41:58 (GMT+0900)
 */var m=Object.defineProperty,$=Object.getOwnPropertySymbols,K=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,H=(e,r,t)=>r in e?m(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,S=(e,r)=>{for(var t in r||(r={}))K.call(r,t)&&H(e,t,r[t]);if($)for(var t of $(r))q.call(r,t)&&H(e,t,r[t]);return e};function G(e){return Array.isArray(e)}function O(e){return typeof e=="object"&&e!==null&&!G(e)}function b(e="",r="-"){return e.replace(/[A-Z]/g,(t,n)=>`${n>0?r:""}${t.toLowerCase()}`)}function w(e="",r=!1){const t=e.replace(/[-_\s](\w)/g,(n,s)=>s.toUpperCase());return r?t.replace(/^\w/,n=>n.toUpperCase()):t}function N(e,r=0){return Array.prototype.slice.call(e,r)}function A(e={},r=!1){const t=r?w:b,n={};for(const[s,i]of Object.entries(e))n[t(s)]=O(i)?A(i,r):i;return n}function J(e,r=document){return e?e instanceof HTMLElement?e:r.querySelector(e):null}function u(e,r={},t){const n=document.createElement(e);for(const[s,i]of Object.entries(r))n.setAttribute(b(s),s==="style"&&O(i)?_(i):String(i));return t&&(Array.isArray(t)||(t=[t]),t.forEach(s=>{if(typeof s=="string"){const i=u("div");i.innerHTML=s,n.append(...i.childNodes)}else n.append(s)})),n}function _(...e){const r=e.reduce((n,s)=>S(S({},n),A(s)),{}),t=[];for(const[n,s]of Object.entries(r))s===""||typeof s>"u"||s===null||t.push(`${n}:${s}`);return t.join(";")}const M=(e,r="style")=>e?(e.getAttribute(r)||"").split(/\s?;\s?/).reduce((n,s)=>{const[i,o]=s.split(/\s?:\s?/);return i&&(n[w(i)]=o),n},{}):{},Q=e=>document.createTextNode(e),X="sp-editor__editor",v="is-empty",x="SECTION",Y="BR",y=[x,"H1","H2","H3","H4","H5","BLOCKQUOTE","UL","OL"];function E(e,r,t){return e.replace(new RegExp("(^<"+r+")|("+r+">$)","gi"),n=>n.replace(new RegExp(r,"i"),t.toLowerCase()))}function Z(e){return e.replace(/<li[^>]*>(.+)<\/li>/gi,"$1")}function C(e){const r=typeof e=="string"?e:e.nodeName;return/^UL|OL$/i.test(r)}function P(e){if(!e)return!1;const r=N(e.childNodes);return r.length>0&&r.every(t=>t.nodeName==="BR")}function L(e){return typeof e!="string"&&e.nodeName&&(e=e.outerHTML),typeof e=="string"&&/^<(\w+)[^>]*>.*<\/\1>$/.test(e.replace(/\n/g,""))}function R(e){return["PICTURE","VIDEO","AUDIO","CANVAS"].includes(e.nodeName)}function z(e){return["IMG"].includes(e.nodeName)||R(e)}function D(e){if(z(e))return!0;for(let r=0;r<e.children.length;r++)if(D(e.children[r]))return!0;return!1}const ee=(e,r)=>{const t={minHeight:e.minHeight,"--placeholder":JSON.stringify(e.placeholder),"--placeholder-color":e.placeholderColor,"--line-height":e.lineHeight,"--paragraph-spacing":e.paragraphTailSpacing,"--padding-bottom":e.paddingBottom,...e.styles};e.caretColor&&(t.caretColor=e.caretColor),e.textColor&&(t.color=e.textColor);const n={class:`${X} ${v}`,style:_(t)};return e.editable&&(n.contenteditable="true"),u("div",n,r)},I=(e,r)=>{var l,c,B,U,j,k,W,V,F;if(!e)return null;const t=e.nodeName,n=r.toUpperCase();if(t===n)return null;const s=u(r),i=e.parentElement;let o;if(t==="LI"&&C(i)){if(s.innerHTML=E(e.outerHTML,t,n),o=s.firstChild,i.childElementCount>1)if(i.firstElementChild===e)(l=i.parentElement)==null||l.insertBefore(o,i);else if(i.lastElementChild===e){const h=(c=i.parentElement)==null?void 0:c.nextElementSibling;h?(B=h.parentElement)==null||B.insertBefore(o,h):(U=i.parentElement)==null||U.append(o)}else{const h=N(i.children),f=u(i.nodeName);let g=h.shift();for(;g&&g!==e;)f.append(g),g=h.shift();(j=i.parentElement)==null||j.insertBefore(f,i),(k=i.parentElement)==null||k.insertBefore(o,i),i.removeChild(e)}else(W=i.parentElement)==null||W.insertBefore(o,i),(V=i.parentElement)==null||V.removeChild(i);return o}if(/UL|OL/.test(n)){const h=e.previousElementSibling,f=e.nextElementSibling;if(h&&C(h)){if(s.innerHTML=E(e.outerHTML,t,"li"),o=s.firstChild,h.append(o),i==null||i.removeChild(e),f&&f.nodeName===h.nodeName){const g=N(f.children);h.append(...g),(F=f.parentElement)==null||F.removeChild(f)}}else f&&C(f)?(s.innerHTML=E(e.outerHTML,t,"li"),o=s.firstChild,f.insertBefore(o,f.firstElementChild),i==null||i.removeChild(e)):(o=s,s.innerHTML=E(e.outerHTML,t,"li"),i==null||i.replaceChild(o,e))}else s.innerHTML=Z(E(e.outerHTML,t,n)),o=s.firstChild,i==null||i.replaceChild(o,e);return o},T=e=>{var r;!((r=e.innerText)!=null&&r.trim())&&!D(e)?e.classList.add(v):e.classList.remove(v)};function te(e,r,t=!1){var n;for(;e&&r!==e;){if(!t&&e.nodeName==="LI"&&((n=e.parentElement)==null?void 0:n.parentElement)===r||e.parentElement===r)return e;e=e.parentElement}return r.lastElementChild}const ne={editable:!0,minHeight:"50vh",paddingBottom:"50vh",placeholder:"请在此输入内容..",placeholderColor:"#999",lineHeight:1.5,childNodeName:x,allowedNodeNames:y,paragraphTailSpacing:"10px",caretColor:"",textColor:"#333333",customPasteHandler:void 0,insertTextToNewParagraph:!1},oe="";class re extends d{constructor(t){super();p(this,"version");p(this,"options");p(this,"$editor");p(this,"_eventHandler");p(this,"allowedNodeNames");p(this,"blankLine");p(this,"range");p(this,"_pasteHandler");const n=typeof t.container=="string"?J(t.container):t.container;if(!n)throw new Error(`Can't found '${t.container}' Node in document!`);this.version="1.0.0",this.options={...ne,...t},this.allowedNodeNames=(this.options.allowedNodeNames||y).map(i=>i.toUpperCase());const s=this.options.childNodeName.toUpperCase();this.options.childNodeName=s,this.blankLine=`<${s}><br></${s}>`,this.allowedNodeNames.includes(s)||this.allowedNodeNames.push(s),this.$editor=ee(this.options,this.blankLine),n.append(this.$editor),this.range=new Range,this.range.setStart(this.$editor.children[0],0),this._eventHandler=i=>{var l;const o=i.type;if(o==="click"){const c=(l=window.getSelection())==null?void 0:l.getRangeAt(0);c&&(this.range=c)}else o==="blur"&&this._verifyChild();this.emit(o==="input"?"change":o,i),T(this.$editor)},this._pasteHandler=i=>{var l;if(typeof this.options.customPasteHandler=="function")return this.options.customPasteHandler(i);i.preventDefault();const o=(l=i.clipboardData)==null?void 0:l.getData("text");this.insert(o)},this._initEvents()}_initEvents(){this.$editor.addEventListener("focus",this._eventHandler),this.$editor.addEventListener("blur",this._eventHandler),this.$editor.addEventListener("input",this._eventHandler),this.$editor.addEventListener("click",this._eventHandler),this.$editor.addEventListener("paste",this._pasteHandler)}setRangeWithNode(t){const n=new Range;return n.setStart(t===this.$editor?this.$editor.childNodes[this.$editor.childNodes.length-1]:t,0),this.range=n,n}use(t,n){typeof t.install=="function"&&t.install(this,n)}setHtml(t){this.$editor.innerHTML=this.blankLine,this.insert(t,!0),T(this.$editor)}getHtml(t){const n=this.$editor.innerHTML;if(t)return n;const s=this.options.childNodeName;return n.replace(new RegExp(`(<${s}><br\\s?\\/?><\\/${s}>)+$`,"i"),"")}insert(t,n=!1){if(!t)return;const{childNodeName:s,insertTextToNewParagraph:i}=this.options;if(t instanceof HTMLElement)this._insertEl(t);else{const o=u("div",{},t),l=N(o.childNodes);if(!n&&!i&&l.every(c=>c.nodeType===Node.TEXT_NODE))return this._insertText(t);l.forEach(c=>{c.nodeType===Node.ELEMENT_NODE?c.nodeName===Y?this._insertEl(u(s,{},"<br/>")):this._insertEl(c):c.textContent&&this._insertEl(u(s,{},c.textContent))})}this._verifyChild(),this._dispatchChange(),T(this.$editor)}_insertEl(t){const n=this.getCursorElement();P(n)?L(t.outerHTML)?this.$editor.insertBefore(t,n):n===this.$editor.children[this.$editor.children.length-1]?this.$editor.insertBefore(u(this.options.childNodeName,{},t),n):(n.innerHTML="",n.append(t)):(L(t.outerHTML)||(t=u(this.options.childNodeName,{},t)),n.nextElementSibling?this.$editor.insertBefore(t,n.nextElementSibling):this.$editor.append(t)),this.setRangeWithNode(t)}_insertText(t){if(!t)return;const n=window.getSelection();if(!(n==null?void 0:n.rangeCount))return this.insert(t,!0);n.deleteFromDocument();const i=Q(t);n.getRangeAt(0).insertNode(i),n.setPosition(i,t.length),this.range=n.getRangeAt(0),n.collapseToEnd()}_verifyChild(){const t=this.options.childNodeName;let n,s,i=!1;const o=this.$editor.childNodes;for(let l=0;l<o.length;l++)s=null,n=o[l],i=n===this.range.commonAncestorContainer,n.nodeType===Node.ELEMENT_NODE&&L(n)&&!R(n)?this.allowedNodeNames.includes(n.nodeName)||(s=I(n,t)):(s=u(t,{},n.cloneNode(!0)),this.$editor.replaceChild(s,n)),i&&s&&this.setRangeWithNode(s);P(this.$editor.lastElementChild)||this.$editor.append(u(t,{},"<br>"))}changeNodeName(t){if(t=(t||this.options.childNodeName).toUpperCase(),!this.allowedNodeNames.includes(t))return!1;const n=this.getCursorElement(),s=I(n,t);return s?(this.setRangeWithNode(s),this._dispatchChange(),!0):!1}changeStyles(t,n){const s=this.getCursorElement(!0);if(s){const i=M(s);if(t){const o=typeof t=="string"?{[t]:n}:t;s.setAttribute("style",_(i,o))}else{if(!Object.keys(i).length)return;s.removeAttribute("style")}this._dispatchChange()}}_dispatchChange(){this.$editor.dispatchEvent(new InputEvent("input"))}getStyles(){return M(this.getCursorElement())}getCursorElement(t=!1){return te(this.range.commonAncestorContainer,this.$editor,t)}destroy(){this.$editor.removeEventListener("focus",this._eventHandler),this.$editor.removeEventListener("blur",this._eventHandler),this.$editor.removeEventListener("input",this._eventHandler),this.$editor.removeEventListener("paste",this._pasteHandler),this.removeAllListeners()}}a.ALLOWED_NODE_NAMES=y,a.Editor=re,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
