/*!
 * @zx-editor/editor version 1.0.0
 * Author: Capricorncd
 * Released under the MIT License
 * Repository: https://github.com/capricorncd/zx-editor
 * Released on: 2022-08-01 22:07:12 (GMT+0900)
 * Copyright © 2018-present, Capricorncd
 */
(function(h,f){typeof exports=="object"&&typeof module<"u"?f(exports):typeof define=="function"&&define.amd?define(["exports"],f):(h=typeof globalThis<"u"?globalThis:h||self,f(h.Editor={}))})(this,function(h){"use strict";var ne=Object.defineProperty;var se=(h,f,y)=>f in h?ne(h,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):h[f]=y;var v=(h,f,y)=>(se(h,typeof f!="symbol"?f+"":f,y),y);class f{constructor(){this._events={}}on(s,e){return!s||!e||typeof e!="function"?this:(this._events[s]||(this._events[s]=[]),this._events[s].push(e),this)}once(s,e){const n=(...i)=>{e.apply(this,i),this.off(s,n)};return this.on(s,n)}emit(s,...e){const n=this._events[s];if(!n)return this;for(let i=0;i<n.length;i++)try{n[i].apply(this,e)}catch(r){this.emit("error",r,"emit")}return this}off(s,e){if(!this._events[s])return this;const n=this._events[s];if(typeof e=="function"){const i=n.findIndex(r=>r===e);i>=0&&n.splice(i,1)}else this._events[s].length=0;return this._removeEmpty(s),this}_removeEmpty(s){this._events[s].length||delete this._events[s]}removeAllListeners(){Object.keys(this._events).forEach(s=>this.off(s))}}/*!
 * zx-sml version 0.2.1
 * Author: Capricorncd <capricorncd@qq.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2022-07-24 15:34:05 (GMT+0900)
 */var y=Object.defineProperty,D=Object.getOwnPropertySymbols,K=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable,$=(t,s,e)=>s in t?y(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e,A=(t,s)=>{for(var e in s||(s={}))K.call(s,e)&&$(t,e,s[e]);if(D)for(var e of D(s))V.call(s,e)&&$(t,e,s[e]);return t};function W(t){return Array.isArray(t)}function M(t){return t!==null&&!W(t)&&typeof t=="object"}var Y=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},L={exports:{}};/*! For license information please see date-utils-2020.js.LICENSE.txt */(function(t,s){(function(e,n){t.exports=n()})(typeof self<"u"?self:Y,function(){return(()=>{var e={949:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.toTwoDigits=void 0,r.toTwoDigits=function(o){return o[1]?o:"0"+o}},607:(i,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.toTwoDigits=r.toDate=r.formatDate=void 0;var _=o(949);Object.defineProperty(r,"toTwoDigits",{enumerable:!0,get:function(){return _.toTwoDigits}});var b={weeks:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]};function T(u){if(u instanceof Date)return u;if(typeof u=="number")return new Date(u);if(typeof u=="string"){var l=u.trim();if(/^\d+$/.test(l)){var m=l.length;return m===8?new Date([l.substr(0,4),l.substr(4,2),l.substr(6,2)].join("/")):m===6?new Date([l.substr(0,4),l.substr(4,2),"01"].join("/")):m===4?new Date(l+"/01/01"):new Date(parseInt(u))}if(l=l.replace(/[年月日]/g,function(a){return a==="\u65E5"?"":"/"}).replace(/[(（（].*?[)））]/g," ").replace(/\bam|pm\b/gi," ").replace(/\s+/g," "),/^(\d{4})[-/](\d{1,2})[-/](\d{1,2})$/.test(l))return new Date([RegExp.$1,RegExp.$2,RegExp.$3].join("/"));if(/^(\d{4})[-/](\d{1,2})$/.test(l))return new Date([RegExp.$1,RegExp.$2,"01"].join("/"));var p=new Date(l);return isNaN(p.getFullYear())?null:p}return null}r.formatDate=function(u,l,m){var p,a=T(u);if(!a||!l)return u+"";if(l==="timestamp")return a.getTime().toString();/(y+)/i.test(l)&&(p=RegExp.$1,l=l.replace(p,(a.getFullYear()+"").substr(4-p.length))),m&&Array.isArray(m.weeks)||(m=b);var N={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"w+":a.getDay(),"W+":m.weeks[a.getDay()],"a+":a.getHours()<12?"am":"pm","A+":a.getHours()<12?"AM":"PM"};for(var c in N)if(new RegExp("("+c+")").test(l)){p=RegExp.$1;var d=N[c]+"";l=l.replace(p,p.length===1?d:_.toTwoDigits(d))}if(/(g)/i.test(l)){var E=a.toString().split(/\s+/).slice(5),re=l.includes("g");l=l.replace(/g/i,re?E[0]:E.join(" "))}return l},r.toDate=T}},n={};return function i(r){if(n[r])return n[r].exports;var o=n[r]={exports:{}};return e[r](o,o.exports,i),o.exports}(607)})()})})(L);function R(t="",s="-"){return t.replace(/[A-Z]/g,(e,n)=>`${n>0?s:""}${e.toLowerCase()}`)}function I(t="",s=!1){const e=t.replace(/[-_\s](\w)/g,(n,i)=>i.toUpperCase());return s?e.replace(/^\w/,n=>n.toUpperCase()):e}function w(t,s=0){return Array.prototype.slice.call(t,s)}function P(t={},s=!1){const e=s?I:R,n={};for(const[i,r]of Object.entries(t))n[e(i)]=M(r)?P(r,s):r;return n}function Q(t,s=document){return t?t instanceof HTMLElement?t:s.querySelector(t):null}function g(t,s={},e){const n=document.createElement(t);for(const[i,r]of Object.entries(s))n.setAttribute(R(i),i==="style"&&M(r)?x(r):r);return e&&(Array.isArray(e)||(e=[e]),e.forEach(i=>{if(typeof i=="string"){const r=g("div");r.innerHTML=i,n.append(...r.childNodes)}else n.append(i)})),n}function x(...t){const s=t.reduce((n,i)=>A(A({},n),P(i)),{}),e=[];for(const[n,i]of Object.entries(s))i===""||typeof i>"u"||i===null||e.push(`${n}:${i}`);return e.join(";")}L.exports.formatDate,L.exports.toDate,L.exports.toTwoDigits;const j=(t,s="style")=>t?(t.getAttribute(s)||"").split(/\s?;\s?/).reduce((n,i)=>{const[r,o]=i.split(/\s?:\s?/);return r&&(n[I(r)]=o),n},{}):{},q=t=>document.createTextNode(t),z="zx-editor__editor",H="SECTION",G="BR",B=["SECTION","H1","H2","H3","H4","H5","BLOCKQUOTE","UL","OL"],J=["DIV","P","ARTICLE","ASIDE","DETAILS","SUMMARY","FOOTER","HEADER","MAIN","NAV","SECTION","H1","H2","H3","H4","H5","H6","BLOCKQUOTE"],U="<section><br></section>";function C(t,s,e){return t.replace(RegExp("(^<"+s+")|("+s+">$)","gi"),n=>n.toUpperCase().replace(s,e.toLowerCase()))}function O(t){return/^UL|OL$/.test(t.nodeName)}function S(t){if(!t)return!1;const s=w(t.childNodes);return s.length===1&&s[0].nodeName==="BR"}const X=t=>{const s={minHeight:t.minHeight,"--placeholder":JSON.stringify(t.placeholder),"--placeholder-color":t.placeholderColor,"--line-height":t.lineHeight,"--paragraph-spacing":t.paragraphTailSpacing,...t.styles};t.caretColor&&(s.caretColor=t.caretColor),t.textColor&&(s.color=t.textColor);const e={class:`${z} is-empty`,style:x(s)};return t.editable&&(e.contenteditable="true"),g("div",e,U)},k=(t,s=H)=>{var _,b,T,u,l,m,p,a,N;if(!t)return null;const e=t.nodeName,n=s.toUpperCase();if(e===n)return t;const i=g(s),r=t.parentElement;let o;if(e==="LI"&&O(r)){if(i.innerHTML=C(t.outerHTML,e,n),o=i.firstChild,r.childElementCount>1)if(r.firstElementChild===t)(_=r.parentElement)==null||_.insertBefore(o,r);else if(r.lastElementChild===t){const c=(b=r.parentElement)==null?void 0:b.nextElementSibling;c?(T=c.parentElement)==null||T.insertBefore(o,c):(u=r.parentElement)==null||u.append(o)}else{const c=w(r.children),d=g(r.nodeName);let E=c.shift();for(;E&&E!==t;)d.append(E),E=c.shift();(l=r.parentElement)==null||l.insertBefore(d,r),(m=r.parentElement)==null||m.insertBefore(o,r),r.removeChild(t)}else(p=r.parentElement)==null||p.insertBefore(o,r),(a=r.parentElement)==null||a.removeChild(r);return o}if(J.includes(e)){if(/UL|OL/.test(n)){const c=t.previousElementSibling,d=t.nextElementSibling;if(c&&O(c)){if(i.innerHTML=C(t.outerHTML,e,"li"),o=i.firstChild,c.append(o),r==null||r.removeChild(t),d&&d.nodeName===c.nodeName){const E=w(d.children);c.append(...E),(N=d.parentElement)==null||N.removeChild(d)}}else d&&O(d)?(i.innerHTML=C(t.outerHTML,e,"li"),o=i.firstChild,d.insertBefore(o,d.firstElementChild),r==null||r.removeChild(t)):(o=i,i.innerHTML=C(t.outerHTML,e,"li"),r==null||r.replaceChild(o,t))}else i.innerHTML=C(t.outerHTML,e,n),o=i.firstChild,r==null||r.replaceChild(o,t);return o}return i.append(t.cloneNode(!0)),r==null||r.replaceChild(i,t),i},F=t=>{t.children.length<=1&&S(t.children[0])?t.classList.add("is-empty"):t.classList.remove("is-empty")};function Z(t,s,e=!1){var n;for(;t&&s!==t;){if(!e&&t.nodeName==="LI"&&((n=t.parentElement)==null?void 0:n.parentElement)===s||t.parentElement===s)return t;t=t.parentElement}return s.lastElementChild}const ee={editable:!0,minHeight:"50vh",placeholder:"\u8BF7\u5728\u6B64\u8F93\u5165\u5185\u5BB9..",placeholderColor:"#999",lineHeight:1.5,allowedNodeNames:B,paragraphTailSpacing:"10px",caretColor:"",textColor:"",customPasteHandler:void 0,insertTextToNewParagraph:!1},ie="";class te extends f{constructor(e){super();v(this,"version");v(this,"options");v(this,"$editor");v(this,"_cursorElement",null);v(this,"_eventHandler");v(this,"allowedNodeNames");v(this,"_pasteHandler");const n=typeof e.container=="string"?Q(e.container):e.container;if(!n)throw new Error(`Can't found '${e.container}' Node in document!`);this.version="1.0.0",this.options={...ee,...e},this.allowedNodeNames=(this.options.allowedNodeNames||B).map(i=>i.toUpperCase()),this.$editor=X(this.options),n.append(this.$editor),this._eventHandler=i=>{var o;const r=i.type;r==="blur"&&(this._lastLine(),this.setCursorElement((o=window.getSelection())==null?void 0:o.getRangeAt(0).endContainer)),this.emit(r==="input"?"change":r,i),F(this.$editor)},this._pasteHandler=i=>{var _;if(typeof this.options.customPasteHandler=="function")return this.options.customPasteHandler(i);i.stopPropagation();const r=(_=i.clipboardData)==null?void 0:_.getData("text"),o=window.getSelection();this._insertText(r,o)},this._initEvents()}_initEvents(){this.$editor.addEventListener("focus",this._eventHandler),this.$editor.addEventListener("blur",this._eventHandler),this.$editor.addEventListener("input",this._eventHandler),this.$editor.addEventListener("click",this._eventHandler),this.$editor.addEventListener("paste",this._pasteHandler)}use(e,n){typeof e.install=="function"&&e.install(this,n)}setHtml(e){this.$editor.innerHTML=U,this.insert(e,!0),this._lastLine(),F(this.$editor)}getHtml(){return this.$editor.innerHTML.replace(/<section><br><\/section>$/,"")}insert(e,n=!1){if(e instanceof HTMLElement)this._insert(e);else{const i=g("div",{},e),r=w(i.childNodes);if(!n&&!this.options.insertTextToNewParagraph&&r.every(o=>o.nodeType===Node.TEXT_NODE))return this._insertText(e);r.forEach(o=>{o.nodeType===Node.ELEMENT_NODE?o.nodeName===G?this._insert(g(H,{},"<br/>")):this._insert(o):o.textContent&&this._insert(g(H,{},o.textContent))})}this._dispatchChange()}_insert(e){const n=this.getCursorElement();S(n)?this.$editor.insertBefore(e,n):this.$editor.insertBefore(e,n.nextElementSibling),this.allowedNodeNames.includes(e.nodeName)||(e=k(e,H)),this.setCursorElement(e)}_insertText(e,n){if(!!e){if(n=n!=null?n:window.getSelection(),!(n!=null&&n.rangeCount))return this.insert(e,!0);n.deleteFromDocument(),n.getRangeAt(0).insertNode(q(e)),this.setCursorElement(n.getRangeAt(0).endContainer),this._dispatchChange()}}_lastLine(){S(this.$editor.lastElementChild)||this.$editor.appendChild(g("section",{},"<br>"))}changeNodeName(e){if(!this.allowedNodeNames.includes(e.toUpperCase()))return!1;const n=this.getCursorElement(),i=k(n,e);return console.log(i),i?(this.setCursorElement(i),this._dispatchChange(),!0):!1}changeStyles(e,n){const i=this.getCursorElement(!0);if(i){const r=typeof e=="string"?{[e]:n}:e;i.setAttribute("style",x(j(i),r)),this._dispatchChange()}}_dispatchChange(){this.$editor.dispatchEvent(new InputEvent("input"))}getStyles(){return j(this.getCursorElement())}setCursorElement(e){if(e instanceof Node)for(;e;){if(e.nodeType===Node.ELEMENT_NODE){this._cursorElement=e;break}e=e.parentElement}else e&&(this._cursorElement=e)}getCursorElement(e=!1){return Z(this._cursorElement,this.$editor,e)}destroy(){this.$editor.removeEventListener("focus",this._eventHandler),this.$editor.removeEventListener("blur",this._eventHandler),this.$editor.removeEventListener("input",this._eventHandler),this.$editor.removeEventListener("paste",this._pasteHandler),this.removeAllListeners()}}h.Editor=te,Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
