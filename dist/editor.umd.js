/*!
 * @sp-editor/editor version 1.0.0
 * Author: Capricorncd
 * Released under the MIT License
 * Repository: https://github.com/capricorncd/zx-editor
 * Copyright © 2018-present, Capricorncd/ Xing Zhong.
 */
(function(h,f){typeof exports=="object"&&typeof module<"u"?f(exports):typeof define=="function"&&define.amd?define(["exports"],f):(h=typeof globalThis<"u"?globalThis:h||self,f(h.Editor={}))})(this,function(h){"use strict";var oe=Object.defineProperty;var le=(h,f,N)=>f in h?oe(h,f,{enumerable:!0,configurable:!0,writable:!0,value:N}):h[f]=N;var _=(h,f,N)=>(le(h,typeof f!="symbol"?f+"":f,N),N);class f{constructor(){this._events={}}on(s,t){return!s||!t||typeof t!="function"?this:(this._events[s]||(this._events[s]=[]),this._events[s].push(t),this)}once(s,t){const r=(...i)=>{t.apply(this,i),this.off(s,r)};return this.on(s,r)}emit(s,...t){const r=this._events[s];if(!r)return this;for(let i=0;i<r.length;i++)try{r[i].apply(this,t)}catch(n){this.emit("error",n,"emit")}return this}off(s,t){if(!this._events[s])return this;const r=this._events[s];if(typeof t=="function"){const i=r.findIndex(n=>n===t);i>=0&&r.splice(i,1)}else this._events[s].length=0;return this._removeEmpty(s),this}_removeEmpty(s){this._events[s].length||delete this._events[s]}removeAllListeners(){Object.keys(this._events).forEach(s=>this.off(s))}}/*!
 * zx-sml version 0.5.1
 * Author: Capricorncd <capricorncd@qq.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2022-08-14 09:57:06 (GMT+0900)
 */var N=Object.defineProperty,O=Object.getOwnPropertySymbols,G=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,D=(e,s,t)=>s in e?N(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,S=(e,s)=>{for(var t in s||(s={}))G.call(s,t)&&D(e,t,s[t]);if(O)for(var t of O(s))K.call(s,t)&&D(e,t,s[t]);return e};function Y(e){return Array.isArray(e)}function M(e){return e!==null&&!Y(e)&&typeof e=="object"}var q=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},b={exports:{}};/*! For license information please see date-utils-2020.js.LICENSE.txt */(function(e,s){(function(t,r){e.exports=r()})(typeof self<"u"?self:q,function(){return(()=>{var t={949:(i,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.toTwoDigits=void 0,n.toTwoDigits=function(o){return o[1]?o:"0"+o}},607:(i,n,o)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.toTwoDigits=n.toDate=n.formatDate=void 0;var a=o(949);Object.defineProperty(n,"toTwoDigits",{enumerable:!0,get:function(){return a.toTwoDigits}});var y={weeks:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]};function T(p){if(p instanceof Date)return p;if(typeof p=="number")return new Date(p);if(typeof p=="string"){var l=p.trim();if(/^\d+$/.test(l)){var g=l.length;return g===8?new Date([l.substr(0,4),l.substr(4,2),l.substr(6,2)].join("/")):g===6?new Date([l.substr(0,4),l.substr(4,2),"01"].join("/")):g===4?new Date(l+"/01/01"):new Date(parseInt(p))}if(l=l.replace(/[年月日]/g,function(d){return d==="\u65E5"?"":"/"}).replace(/[(（（].*?[)））]/g," ").replace(/\bam|pm\b/gi," ").replace(/\s+/g," "),/^(\d{4})[-/](\d{1,2})[-/](\d{1,2})$/.test(l))return new Date([RegExp.$1,RegExp.$2,RegExp.$3].join("/"));if(/^(\d{4})[-/](\d{1,2})$/.test(l))return new Date([RegExp.$1,RegExp.$2,"01"].join("/"));var m=new Date(l);return isNaN(m.getFullYear())?null:m}return null}n.formatDate=function(p,l,g){var m,d=T(p);if(!d||!l)return p+"";if(l==="timestamp")return d.getTime().toString();/(y+)/i.test(l)&&(m=RegExp.$1,l=l.replace(m,(d.getFullYear()+"").substr(4-m.length))),g&&Array.isArray(g.weeks)||(g=y);var w={"M+":d.getMonth()+1,"d+":d.getDate(),"h+":d.getHours(),"m+":d.getMinutes(),"s+":d.getSeconds(),"w+":d.getDay(),"W+":g.weeks[d.getDay()],"a+":d.getHours()<12?"am":"pm","A+":d.getHours()<12?"AM":"PM"};for(var c in w)if(new RegExp("("+c+")").test(l)){m=RegExp.$1;var u=w[c]+"";l=l.replace(m,m.length===1?u:a.toTwoDigits(u))}if(/(g)/i.test(l)){var v=d.toString().split(/\s+/).slice(5),se=l.includes("g");l=l.replace(/g/i,se?v[0]:v.join(" "))}return l},n.toDate=T}},r={};return function i(n){if(r[n])return r[n].exports;var o=r[n]={exports:{}};return t[n](o,o.exports,i),o.exports}(607)})()})})(b);function A(e="",s="-"){return e.replace(/[A-Z]/g,(t,r)=>`${r>0?s:""}${t.toLowerCase()}`)}function j(e="",s=!1){const t=e.replace(/[-_\s](\w)/g,(r,i)=>i.toUpperCase());return s?t.replace(/^\w/,r=>r.toUpperCase()):t}function L(e,s=0){return Array.prototype.slice.call(e,s)}function P(e={},s=!1){const t=s?j:A,r={};for(const[i,n]of Object.entries(e))r[t(i)]=M(n)?P(n,s):n;return r}function J(e,s=document){return e?e instanceof HTMLElement?e:s.querySelector(e):null}function E(e,s={},t){const r=document.createElement(e);for(const[i,n]of Object.entries(s))r.setAttribute(A(i),i==="style"&&M(n)?$(n):n);return t&&(Array.isArray(t)||(t=[t]),t.forEach(i=>{if(typeof i=="string"){const n=E("div");n.innerHTML=i,r.append(...n.childNodes)}else r.append(i)})),r}function $(...e){const s=e.reduce((r,i)=>S(S({},r),P(i)),{}),t=[];for(const[r,i]of Object.entries(s))i===""||typeof i>"u"||i===null||t.push(`${r}:${i}`);return t.join(";")}b.exports.formatDate,b.exports.toDate,b.exports.toTwoDigits;const B=(e,s="style")=>e?(e.getAttribute(s)||"").split(/\s?;\s?/).reduce((r,i)=>{const[n,o]=i.split(/\s?:\s?/);return n&&(r[j(n)]=o),r},{}):{},Q=e=>document.createTextNode(e),X="sp-editor__editor",R="SECTION",Z="BR",H=[R,"H1","H2","H3","H4","H5","BLOCKQUOTE","UL","OL"];function C(e,s,t){return e.replace(RegExp("(^<"+s+")|("+s+">$)","gi"),r=>r.toUpperCase().replace(s,t.toLowerCase()))}function z(e){return e.replace(/<li[^>]*>(.+)<\/li>/gi,"$1")}function x(e){const s=typeof e=="string"?e:e.nodeName;return/^UL|OL$/i.test(s)}function k(e){if(!e)return!1;const s=L(e.childNodes);return s.length===1&&s[0].nodeName==="BR"}function I(e){return e instanceof Element&&(e=e.outerHTML),/^<(\w+)[^>]*>.*<\/\1>$/.test(e)}function U(e){return["PICTURE","VIDEO","AUDIO","CANVAS"].includes(e.nodeName)}function ee(e){return["IMG"].includes(e.nodeName)||U(e)}function F(e){if(ee(e))return!0;for(let s=0;s<e.children.length;s++)if(F(e.children[s]))return!0;return!1}const te=(e,s)=>{const t={minHeight:e.minHeight,"--placeholder":JSON.stringify(e.placeholder),"--placeholder-color":e.placeholderColor,"--line-height":e.lineHeight,"--paragraph-spacing":e.paragraphTailSpacing,"--padding-bottom":e.paddingBottom,...e.styles};e.caretColor&&(t.caretColor=e.caretColor),e.textColor&&(t.color=e.textColor);const r={class:`${X} is-empty`,style:$(t)};return e.editable&&(r.contenteditable="true"),E("div",r,s)},W=(e,s)=>{var a,y,T,p,l,g,m,d,w;if(!e)return null;const t=e.nodeName,r=s.toUpperCase();if(t===r)return null;const i=E(s),n=e.parentElement;let o;if(t==="LI"&&x(n)){if(i.innerHTML=C(e.outerHTML,t,r),o=i.firstChild,n.childElementCount>1)if(n.firstElementChild===e)(a=n.parentElement)==null||a.insertBefore(o,n);else if(n.lastElementChild===e){const c=(y=n.parentElement)==null?void 0:y.nextElementSibling;c?(T=c.parentElement)==null||T.insertBefore(o,c):(p=n.parentElement)==null||p.append(o)}else{const c=L(n.children),u=E(n.nodeName);let v=c.shift();for(;v&&v!==e;)u.append(v),v=c.shift();(l=n.parentElement)==null||l.insertBefore(u,n),(g=n.parentElement)==null||g.insertBefore(o,n),n.removeChild(e)}else(m=n.parentElement)==null||m.insertBefore(o,n),(d=n.parentElement)==null||d.removeChild(n);return o}if(/UL|OL/.test(r)){const c=e.previousElementSibling,u=e.nextElementSibling;if(c&&x(c)){if(i.innerHTML=C(e.outerHTML,t,"li"),o=i.firstChild,c.append(o),n==null||n.removeChild(e),u&&u.nodeName===c.nodeName){const v=L(u.children);c.append(...v),(w=u.parentElement)==null||w.removeChild(u)}}else u&&x(u)?(i.innerHTML=C(e.outerHTML,t,"li"),o=i.firstChild,u.insertBefore(o,u.firstElementChild),n==null||n.removeChild(e)):(o=i,i.innerHTML=C(e.outerHTML,t,"li"),n==null||n.replaceChild(o,e))}else i.innerHTML=z(C(e.outerHTML,t,r)),o=i.firstChild,n==null||n.replaceChild(o,e);return o},V=e=>{!e.innerText.trim()&&!F(e)?e.classList.add("is-empty"):e.classList.remove("is-empty")};function ne(e,s,t=!1){var r;for(;e&&s!==e;){if(!t&&e.nodeName==="LI"&&((r=e.parentElement)==null?void 0:r.parentElement)===s||e.parentElement===s)return e;e=e.parentElement}return s.lastElementChild}const re={editable:!0,minHeight:"50vh",paddingBottom:"50vh",placeholder:"\u8BF7\u5728\u6B64\u8F93\u5165\u5185\u5BB9..",placeholderColor:"#999",lineHeight:1.5,childNodeName:R,allowedNodeNames:H,paragraphTailSpacing:"10px",caretColor:"",textColor:"#333333",customPasteHandler:void 0,insertTextToNewParagraph:!1},ae="";class ie extends f{constructor(t){super();_(this,"version");_(this,"options");_(this,"$editor");_(this,"_cursorElement",null);_(this,"_eventHandler");_(this,"allowedNodeNames");_(this,"blankLine");_(this,"_pasteHandler");const r=typeof t.container=="string"?J(t.container):t.container;if(!r)throw new Error(`Can't found '${t.container}' Node in document!`);this.version="1.0.0",this.options={...re,...t},this.allowedNodeNames=(this.options.allowedNodeNames||H).map(n=>n.toUpperCase());const i=this.options.childNodeName.toUpperCase();this.options.childNodeName=i,this.blankLine=`<${i}><br></${i}>`,this.allowedNodeNames.includes(i)||this.allowedNodeNames.push(i),this.$editor=te(this.options,this.blankLine),r.append(this.$editor),this._eventHandler=n=>{const o=n.type;if(o==="blur"||o==="click"){const a=window.getSelection(),y=a&&a.rangeCount?a.getRangeAt(a.rangeCount-1).endContainer:n.currentTarget;this.setCursorElement(y),o==="blur"&&this._verifyChild()}this.emit(o==="input"?"change":o,n),V(this.$editor)},this._pasteHandler=n=>{var a;if(typeof this.options.customPasteHandler=="function")return this.options.customPasteHandler(n);n.preventDefault();const o=(a=n.clipboardData)==null?void 0:a.getData("text");this._insertText(o)},this._initEvents()}_initEvents(){this.$editor.addEventListener("focus",this._eventHandler),this.$editor.addEventListener("blur",this._eventHandler),this.$editor.addEventListener("input",this._eventHandler),this.$editor.addEventListener("click",this._eventHandler),this.$editor.addEventListener("paste",this._pasteHandler)}use(t,r){typeof t.install=="function"&&t.install(this,r)}setHtml(t){this.$editor.innerHTML=this.blankLine,this.insert(t,!0),this._verifyChild(),V(this.$editor)}getHtml(t){const r=this.$editor.innerHTML;if(t)return r;const i=this.options.childNodeName;return r.replace(new RegExp(`(<${i}><br\\s?\\/?><\\/${i}>)+$`,"i"),"")}insert(t,r=!1){if(t instanceof HTMLElement)this._insertEl(t);else{const i=E("div",{},t),n=L(i.childNodes);if(!r&&!this.options.insertTextToNewParagraph&&n.every(o=>o.nodeType===Node.TEXT_NODE))return this._insertText(t);n.forEach(o=>{o.nodeType===Node.ELEMENT_NODE?o.nodeName===Z?this._insertEl(E(this.options.childNodeName,{},"<br/>")):this._insertEl(o):o.textContent&&this._insertEl(E(this.options.childNodeName,{},o.textContent))})}this._dispatchChange(),this._verifyChild()}_insertEl(t){const r=this.getCursorElement();k(r)?I(t.outerHTML)?this.$editor.insertBefore(t,r):(r.innerHTML="",r.append(t)):this.$editor.insertBefore(t,r.nextElementSibling),this.setCursorElement(t)}_insertText(t){if(!t)return;const r=window.getSelection(),i=r==null?void 0:r.rangeCount;if(!i)return this.insert(t,!0);r.deleteFromDocument(),r.getRangeAt(0).insertNode(Q(t)),this.setCursorElement(r.getRangeAt(i-1).endContainer),r.collapseToEnd(),this._dispatchChange()}_verifyChild(){const t=this.getCursorElement(!0),r=this.options.childNodeName;let i,n=!1,o=0;for(;o<this.$editor.childNodes.length;){if(i=this.$editor.childNodes[o++],i.nodeType===Node.ELEMENT_NODE){if(I(i)){if(this.allowedNodeNames.includes(i.nodeName))continue;if(n=t===i,!U(i)){const a=W(i,r);n&&a&&this.setCursorElement(a);continue}}i.replaceWith(E(r,{},i.cloneNode(!0)))}else{const a=E(r,{},i.cloneNode(!0));this.$editor.replaceChild(a,i)}console.log(o,i.nodeName,i.nodeType)}k(this.$editor.lastElementChild)||this.$editor.appendChild(E(r,{},"<br>"))}changeNodeName(t){if(t=(t||this.options.childNodeName).toUpperCase(),!this.allowedNodeNames.includes(t))return!1;const r=this.getCursorElement(),i=W(r,t);return i?(this.setCursorElement(i),this._dispatchChange(),!0):!1}changeStyles(t,r){const i=this.getCursorElement(!0);if(i){const n=B(i);if(t){const o=typeof t=="string"?{[t]:r}:t;i.setAttribute("style",$(n,o))}else{if(!Object.keys(n).length)return;i.removeAttribute("style")}this._dispatchChange()}}_dispatchChange(){this.$editor.dispatchEvent(new InputEvent("input"))}getStyles(){return B(this.getCursorElement())}setCursorElement(t){if(t instanceof Node)for(;t;){if(t.nodeType===Node.ELEMENT_NODE){this._cursorElement=t;break}t=t.parentElement}else t&&(this._cursorElement=t)}getCursorElement(t=!1){return ne(this._cursorElement,this.$editor,t)}destroy(){this.$editor.removeEventListener("focus",this._eventHandler),this.$editor.removeEventListener("blur",this._eventHandler),this.$editor.removeEventListener("input",this._eventHandler),this.$editor.removeEventListener("paste",this._pasteHandler),this.removeAllListeners()}}h.ALLOWED_NODE_NAMES=H,h.Editor=ie,Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
