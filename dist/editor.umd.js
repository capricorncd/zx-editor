/*!
 * @sp-editor/editor version 1.0.0
 * Author: Capricorncd
 * Released under the MIT License
 * Repository: https://github.com/capricorncd/sp-editor
 * Released on: 2022-08-20 21:17:03 (GMT+0900)
 * Copyright © 2018-present, Capricorncd
 */
(function(h,f){typeof exports=="object"&&typeof module<"u"?f(exports):typeof define=="function"&&define.amd?define(["exports"],f):(h=typeof globalThis<"u"?globalThis:h||self,f(h.Editor={}))})(this,function(h){"use strict";var se=Object.defineProperty;var oe=(h,f,N)=>f in h?se(h,f,{enumerable:!0,configurable:!0,writable:!0,value:N}):h[f]=N;var _=(h,f,N)=>(oe(h,typeof f!="symbol"?f+"":f,N),N);class f{constructor(){this._events={}}on(s,t){return!s||!t||typeof t!="function"?this:(this._events[s]||(this._events[s]=[]),this._events[s].push(t),this)}once(s,t){const n=(...i)=>{t.apply(this,i),this.off(s,n)};return this.on(s,n)}emit(s,...t){const n=this._events[s];if(!n)return this;for(let i=0;i<n.length;i++)try{n[i].apply(this,t)}catch(r){this.emit("error",r,"emit")}return this}off(s,t){if(!this._events[s])return this;const n=this._events[s];if(typeof t=="function"){const i=n.findIndex(r=>r===t);i>=0&&n.splice(i,1)}else this._events[s].length=0;return this._removeEmpty(s),this}_removeEmpty(s){this._events[s].length||delete this._events[s]}removeAllListeners(){Object.keys(this._events).forEach(s=>this.off(s))}}/*!
 * zx-sml version 0.5.1
 * Author: Capricorncd <capricorncd@qq.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2022-08-14 09:57:06 (GMT+0900)
 */var N=Object.defineProperty,O=Object.getOwnPropertySymbols,K=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable,D=(e,s,t)=>s in e?N(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,S=(e,s)=>{for(var t in s||(s={}))K.call(s,t)&&D(e,t,s[t]);if(O)for(var t of O(s))Y.call(s,t)&&D(e,t,s[t]);return e};function q(e){return Array.isArray(e)}function M(e){return e!==null&&!q(e)&&typeof e=="object"}var G=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},b={exports:{}};/*! For license information please see date-utils-2020.js.LICENSE.txt */(function(e,s){(function(t,n){e.exports=n()})(typeof self<"u"?self:G,function(){return(()=>{var t={949:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.toTwoDigits=void 0,r.toTwoDigits=function(o){return o[1]?o:"0"+o}},607:(i,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.toTwoDigits=r.toDate=r.formatDate=void 0;var a=o(949);Object.defineProperty(r,"toTwoDigits",{enumerable:!0,get:function(){return a.toTwoDigits}});var y={weeks:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]};function T(p){if(p instanceof Date)return p;if(typeof p=="number")return new Date(p);if(typeof p=="string"){var l=p.trim();if(/^\d+$/.test(l)){var g=l.length;return g===8?new Date([l.substr(0,4),l.substr(4,2),l.substr(6,2)].join("/")):g===6?new Date([l.substr(0,4),l.substr(4,2),"01"].join("/")):g===4?new Date(l+"/01/01"):new Date(parseInt(p))}if(l=l.replace(/[年月日]/g,function(d){return d==="\u65E5"?"":"/"}).replace(/[(（（].*?[)））]/g," ").replace(/\bam|pm\b/gi," ").replace(/\s+/g," "),/^(\d{4})[-/](\d{1,2})[-/](\d{1,2})$/.test(l))return new Date([RegExp.$1,RegExp.$2,RegExp.$3].join("/"));if(/^(\d{4})[-/](\d{1,2})$/.test(l))return new Date([RegExp.$1,RegExp.$2,"01"].join("/"));var m=new Date(l);return isNaN(m.getFullYear())?null:m}return null}r.formatDate=function(p,l,g){var m,d=T(p);if(!d||!l)return p+"";if(l==="timestamp")return d.getTime().toString();/(y+)/i.test(l)&&(m=RegExp.$1,l=l.replace(m,(d.getFullYear()+"").substr(4-m.length))),g&&Array.isArray(g.weeks)||(g=y);var w={"M+":d.getMonth()+1,"d+":d.getDate(),"h+":d.getHours(),"m+":d.getMinutes(),"s+":d.getSeconds(),"w+":d.getDay(),"W+":g.weeks[d.getDay()],"a+":d.getHours()<12?"am":"pm","A+":d.getHours()<12?"AM":"PM"};for(var c in w)if(new RegExp("("+c+")").test(l)){m=RegExp.$1;var u=w[c]+"";l=l.replace(m,m.length===1?u:a.toTwoDigits(u))}if(/(g)/i.test(l)){var v=d.toString().split(/\s+/).slice(5),ie=l.includes("g");l=l.replace(/g/i,ie?v[0]:v.join(" "))}return l},r.toDate=T}},n={};return function i(r){if(n[r])return n[r].exports;var o=n[r]={exports:{}};return t[r](o,o.exports,i),o.exports}(607)})()})})(b);function A(e="",s="-"){return e.replace(/[A-Z]/g,(t,n)=>`${n>0?s:""}${t.toLowerCase()}`)}function P(e="",s=!1){const t=e.replace(/[-_\s](\w)/g,(n,i)=>i.toUpperCase());return s?t.replace(/^\w/,n=>n.toUpperCase()):t}function L(e,s=0){return Array.prototype.slice.call(e,s)}function j(e={},s=!1){const t=s?P:A,n={};for(const[i,r]of Object.entries(e))n[t(i)]=M(r)?j(r,s):r;return n}function J(e,s=document){return e?e instanceof HTMLElement?e:s.querySelector(e):null}function E(e,s={},t){const n=document.createElement(e);for(const[i,r]of Object.entries(s))n.setAttribute(A(i),i==="style"&&M(r)?$(r):r);return t&&(Array.isArray(t)||(t=[t]),t.forEach(i=>{if(typeof i=="string"){const r=E("div");r.innerHTML=i,n.append(...r.childNodes)}else n.append(i)})),n}function $(...e){const s=e.reduce((n,i)=>S(S({},n),j(i)),{}),t=[];for(const[n,i]of Object.entries(s))i===""||typeof i>"u"||i===null||t.push(`${n}:${i}`);return t.join(";")}b.exports.formatDate,b.exports.toDate,b.exports.toTwoDigits;const B=(e,s="style")=>e?(e.getAttribute(s)||"").split(/\s?;\s?/).reduce((n,i)=>{const[r,o]=i.split(/\s?:\s?/);return r&&(n[P(r)]=o),n},{}):{},Q=e=>document.createTextNode(e),X="sp-editor__editor",R="SECTION",Z="BR",H=[R,"H1","H2","H3","H4","H5","BLOCKQUOTE","UL","OL"];function C(e,s,t){return e.replace(RegExp("(^<"+s+")|("+s+">$)","gi"),n=>n.toUpperCase().replace(s,t.toLowerCase()))}function z(e){return e.replace(/<li[^>]*>(.+)<\/li>/gi,"$1")}function x(e){const s=typeof e=="string"?e:e.nodeName;return/^UL|OL$/i.test(s)}function k(e){if(!e)return!1;const s=L(e.childNodes);return s.length===1&&s[0].nodeName==="BR"}function I(e){return e instanceof Element&&(e=e.outerHTML),/^<(\w+)[^>]*>.*<\/\1>$/.test(e)}function U(e){return["PICTURE","VIDEO","AUDIO","CANVAS"].includes(e.nodeName)}function F(e){if(U(e))return!0;for(let s=0;s<e.children.length;s++)if(F(e.children[s]))return!0;return!1}const ee=(e,s)=>{const t={minHeight:e.minHeight,"--placeholder":JSON.stringify(e.placeholder),"--placeholder-color":e.placeholderColor,"--line-height":e.lineHeight,"--paragraph-spacing":e.paragraphTailSpacing,"--padding-bottom":e.paddingBottom,...e.styles};e.caretColor&&(t.caretColor=e.caretColor),e.textColor&&(t.color=e.textColor);const n={class:`${X} is-empty`,style:$(t)};return e.editable&&(n.contenteditable="true"),E("div",n,s)},W=(e,s)=>{var a,y,T,p,l,g,m,d,w;if(!e)return null;const t=e.nodeName,n=s.toUpperCase();if(t===n)return null;const i=E(s),r=e.parentElement;let o;if(t==="LI"&&x(r)){if(i.innerHTML=C(e.outerHTML,t,n),o=i.firstChild,r.childElementCount>1)if(r.firstElementChild===e)(a=r.parentElement)==null||a.insertBefore(o,r);else if(r.lastElementChild===e){const c=(y=r.parentElement)==null?void 0:y.nextElementSibling;c?(T=c.parentElement)==null||T.insertBefore(o,c):(p=r.parentElement)==null||p.append(o)}else{const c=L(r.children),u=E(r.nodeName);let v=c.shift();for(;v&&v!==e;)u.append(v),v=c.shift();(l=r.parentElement)==null||l.insertBefore(u,r),(g=r.parentElement)==null||g.insertBefore(o,r),r.removeChild(e)}else(m=r.parentElement)==null||m.insertBefore(o,r),(d=r.parentElement)==null||d.removeChild(r);return o}if(/UL|OL/.test(n)){const c=e.previousElementSibling,u=e.nextElementSibling;if(c&&x(c)){if(i.innerHTML=C(e.outerHTML,t,"li"),o=i.firstChild,c.append(o),r==null||r.removeChild(e),u&&u.nodeName===c.nodeName){const v=L(u.children);c.append(...v),(w=u.parentElement)==null||w.removeChild(u)}}else u&&x(u)?(i.innerHTML=C(e.outerHTML,t,"li"),o=i.firstChild,u.insertBefore(o,u.firstElementChild),r==null||r.removeChild(e)):(o=i,i.innerHTML=C(e.outerHTML,t,"li"),r==null||r.replaceChild(o,e))}else i.innerHTML=z(C(e.outerHTML,t,n)),o=i.firstChild,r==null||r.replaceChild(o,e);return o},V=e=>{!e.innerText.trim()&&!F(e)?e.classList.add("is-empty"):e.classList.remove("is-empty")};function te(e,s,t=!1){var n;for(;e&&s!==e;){if(!t&&e.nodeName==="LI"&&((n=e.parentElement)==null?void 0:n.parentElement)===s||e.parentElement===s)return e;e=e.parentElement}return s.lastElementChild}const re={editable:!0,minHeight:"50vh",paddingBottom:"50vh",placeholder:"\u8BF7\u5728\u6B64\u8F93\u5165\u5185\u5BB9..",placeholderColor:"#999",lineHeight:1.5,childNodeName:R,allowedNodeNames:H,paragraphTailSpacing:"10px",caretColor:"",textColor:"#333333",customPasteHandler:void 0,insertTextToNewParagraph:!1},le="";class ne extends f{constructor(t){super();_(this,"version");_(this,"options");_(this,"$editor");_(this,"_cursorElement",null);_(this,"_eventHandler");_(this,"allowedNodeNames");_(this,"blankLine");_(this,"_pasteHandler");const n=typeof t.container=="string"?J(t.container):t.container;if(!n)throw new Error(`Can't found '${t.container}' Node in document!`);this.version="1.0.0",this.options={...re,...t},this.allowedNodeNames=(this.options.allowedNodeNames||H).map(r=>r.toUpperCase());const i=this.options.childNodeName.toUpperCase();this.options.childNodeName=i,this.blankLine=`<${i}><br></${i}>`,this.allowedNodeNames.includes(i)||this.allowedNodeNames.push(i),this.$editor=ee(this.options,this.blankLine),n.append(this.$editor),this._eventHandler=r=>{const o=r.type;if(o==="blur"||o==="click"){const a=window.getSelection(),y=a&&a.rangeCount?a.getRangeAt(a.rangeCount-1).endContainer:r.currentTarget;this.setCursorElement(y),o==="blur"&&this._verifyChild()}this.emit(o==="input"?"change":o,r),V(this.$editor)},this._pasteHandler=r=>{var a;if(typeof this.options.customPasteHandler=="function")return this.options.customPasteHandler(r);r.preventDefault();const o=(a=r.clipboardData)==null?void 0:a.getData("text");this._insertText(o)},this._initEvents()}_initEvents(){this.$editor.addEventListener("focus",this._eventHandler),this.$editor.addEventListener("blur",this._eventHandler),this.$editor.addEventListener("input",this._eventHandler),this.$editor.addEventListener("click",this._eventHandler),this.$editor.addEventListener("paste",this._pasteHandler)}use(t,n){typeof t.install=="function"&&t.install(this,n)}setHtml(t){this.$editor.innerHTML=this.blankLine,this.insert(t,!0),this._verifyChild(),V(this.$editor)}getHtml(t){const n=this.$editor.innerHTML;if(t)return n;const i=this.options.childNodeName;return n.replace(new RegExp(`(<${i}><br\\s?\\/?><\\/${i}>)+$`,"i"),"")}insert(t,n=!1){if(t instanceof HTMLElement)this._insertEl(t);else{const i=E("div",{},t),r=L(i.childNodes);if(!n&&!this.options.insertTextToNewParagraph&&r.every(o=>o.nodeType===Node.TEXT_NODE))return this._insertText(t);r.forEach(o=>{o.nodeType===Node.ELEMENT_NODE?o.nodeName===Z?this._insertEl(E(this.options.childNodeName,{},"<br/>")):this._insertEl(o):o.textContent&&this._insertEl(E(this.options.childNodeName,{},o.textContent))})}this._dispatchChange(),this._verifyChild()}_insertEl(t){const n=this.getCursorElement();k(n)?I(t.outerHTML)?this.$editor.insertBefore(t,n):(n.innerHTML="",n.append(t)):this.$editor.insertBefore(t,n.nextElementSibling),this.setCursorElement(t)}_insertText(t){if(!t)return;const n=window.getSelection(),i=n==null?void 0:n.rangeCount;if(!i)return this.insert(t,!0);n.deleteFromDocument(),n.getRangeAt(0).insertNode(Q(t)),this.setCursorElement(n.getRangeAt(i-1).endContainer),n.collapseToEnd(),this._dispatchChange()}_verifyChild(){const t=this.getCursorElement(!0),n=this.options.childNodeName;let i,r=!1,o=0;for(;o<this.$editor.childNodes.length;){if(i=this.$editor.childNodes[o++],i.nodeType===Node.ELEMENT_NODE){if(I(i)){if(this.allowedNodeNames.includes(i.nodeName))continue;if(r=t===i,!U(i)){const a=W(i,n);r&&a&&this.setCursorElement(a);continue}}i.replaceWith(E(n,{},i.cloneNode(!0)))}else{const a=E(n,{},i.cloneNode(!0));this.$editor.replaceChild(a,i)}console.log(o)}k(this.$editor.lastElementChild)||this.$editor.appendChild(E(n,{},"<br>"))}changeNodeName(t){if(t=(t||this.options.childNodeName).toUpperCase(),!this.allowedNodeNames.includes(t))return!1;const n=this.getCursorElement(),i=W(n,t);return i?(this.setCursorElement(i),this._dispatchChange(),!0):!1}changeStyles(t,n){const i=this.getCursorElement(!0);if(i){const r=B(i);if(t){const o=typeof t=="string"?{[t]:n}:t;i.setAttribute("style",$(r,o))}else{if(!Object.keys(r).length)return;i.removeAttribute("style")}this._dispatchChange()}}_dispatchChange(){this.$editor.dispatchEvent(new InputEvent("input"))}getStyles(){return B(this.getCursorElement())}setCursorElement(t){if(t instanceof Node)for(;t;){if(t.nodeType===Node.ELEMENT_NODE){this._cursorElement=t;break}t=t.parentElement}else t&&(this._cursorElement=t)}getCursorElement(t=!1){return te(this._cursorElement,this.$editor,t)}destroy(){this.$editor.removeEventListener("focus",this._eventHandler),this.$editor.removeEventListener("blur",this._eventHandler),this.$editor.removeEventListener("input",this._eventHandler),this.$editor.removeEventListener("paste",this._pasteHandler),this.removeAllListeners()}}h.ALLOWED_NODE_NAMES=H,h.Editor=ne,Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
