/*!
 * @zx-editor/editor version 1.0.0
 * Author: Capricorncd
 * Released under the MIT License
 * Repository: https://github.com/capricorncd/zx-editor
 * Released on: 2022-08-14 10:28:58 (GMT+0900)
 * Copyright © 2018-present, Capricorncd
 */
(function(h,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(h=typeof globalThis<"u"?globalThis:h||self,u(h.Editor={}))})(this,function(h){"use strict";var ne=Object.defineProperty;var re=(h,u,N)=>u in h?ne(h,u,{enumerable:!0,configurable:!0,writable:!0,value:N}):h[u]=N;var _=(h,u,N)=>(re(h,typeof u!="symbol"?u+"":u,N),N);class u{constructor(){this._events={}}on(s,e){return!s||!e||typeof e!="function"?this:(this._events[s]||(this._events[s]=[]),this._events[s].push(e),this)}once(s,e){const r=(...i)=>{e.apply(this,i),this.off(s,r)};return this.on(s,r)}emit(s,...e){const r=this._events[s];if(!r)return this;for(let i=0;i<r.length;i++)try{r[i].apply(this,e)}catch(n){this.emit("error",n,"emit")}return this}off(s,e){if(!this._events[s])return this;const r=this._events[s];if(typeof e=="function"){const i=r.findIndex(n=>n===e);i>=0&&r.splice(i,1)}else this._events[s].length=0;return this._removeEmpty(s),this}_removeEmpty(s){this._events[s].length||delete this._events[s]}removeAllListeners(){Object.keys(this._events).forEach(s=>this.off(s))}}/*!
 * zx-sml version 0.2.1
 * Author: Capricorncd <capricorncd@qq.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2022-07-24 15:34:05 (GMT+0900)
 */var N=Object.defineProperty,S=Object.getOwnPropertySymbols,F=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable,A=(t,s,e)=>s in t?N(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e,M=(t,s)=>{for(var e in s||(s={}))F.call(s,e)&&A(t,e,s[e]);if(S)for(var e of S(s))V.call(s,e)&&A(t,e,s[e]);return t};function W(t){return Array.isArray(t)}function R(t){return t!==null&&!W(t)&&typeof t=="object"}var K=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},b={exports:{}};/*! For license information please see date-utils-2020.js.LICENSE.txt */(function(t,s){(function(e,r){t.exports=r()})(typeof self<"u"?self:K,function(){return(()=>{var e={949:(i,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.toTwoDigits=void 0,n.toTwoDigits=function(o){return o[1]?o:"0"+o}},607:(i,n,o)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.toTwoDigits=n.toDate=n.formatDate=void 0;var f=o(949);Object.defineProperty(n,"toTwoDigits",{enumerable:!0,get:function(){return f.toTwoDigits}});var y={weeks:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]};function T(p){if(p instanceof Date)return p;if(typeof p=="number")return new Date(p);if(typeof p=="string"){var l=p.trim();if(/^\d+$/.test(l)){var E=l.length;return E===8?new Date([l.substr(0,4),l.substr(4,2),l.substr(6,2)].join("/")):E===6?new Date([l.substr(0,4),l.substr(4,2),"01"].join("/")):E===4?new Date(l+"/01/01"):new Date(parseInt(p))}if(l=l.replace(/[年月日]/g,function(a){return a==="\u65E5"?"":"/"}).replace(/[(（（].*?[)））]/g," ").replace(/\bam|pm\b/gi," ").replace(/\s+/g," "),/^(\d{4})[-/](\d{1,2})[-/](\d{1,2})$/.test(l))return new Date([RegExp.$1,RegExp.$2,RegExp.$3].join("/"));if(/^(\d{4})[-/](\d{1,2})$/.test(l))return new Date([RegExp.$1,RegExp.$2,"01"].join("/"));var m=new Date(l);return isNaN(m.getFullYear())?null:m}return null}n.formatDate=function(p,l,E){var m,a=T(p);if(!a||!l)return p+"";if(l==="timestamp")return a.getTime().toString();/(y+)/i.test(l)&&(m=RegExp.$1,l=l.replace(m,(a.getFullYear()+"").substr(4-m.length))),E&&Array.isArray(E.weeks)||(E=y);var L={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"w+":a.getDay(),"W+":E.weeks[a.getDay()],"a+":a.getHours()<12?"am":"pm","A+":a.getHours()<12?"AM":"PM"};for(var d in L)if(new RegExp("("+d+")").test(l)){m=RegExp.$1;var c=L[d]+"";l=l.replace(m,m.length===1?c:f.toTwoDigits(c))}if(/(g)/i.test(l)){var g=a.toString().split(/\s+/).slice(5),te=l.includes("g");l=l.replace(/g/i,te?g[0]:g.join(" "))}return l},n.toDate=T}},r={};return function i(n){if(r[n])return r[n].exports;var o=r[n]={exports:{}};return e[n](o,o.exports,i),o.exports}(607)})()})})(b);function j(t="",s="-"){return t.replace(/[A-Z]/g,(e,r)=>`${r>0?s:""}${e.toLowerCase()}`)}function B(t="",s=!1){const e=t.replace(/[-_\s](\w)/g,(r,i)=>i.toUpperCase());return s?e.replace(/^\w/,r=>r.toUpperCase()):e}function w(t,s=0){return Array.prototype.slice.call(t,s)}function P(t={},s=!1){const e=s?B:j,r={};for(const[i,n]of Object.entries(t))r[e(i)]=R(n)?P(n,s):n;return r}function Y(t,s=document){return t?t instanceof HTMLElement?t:s.querySelector(t):null}function v(t,s={},e){const r=document.createElement(t);for(const[i,n]of Object.entries(s))r.setAttribute(j(i),i==="style"&&R(n)?H(n):n);return e&&(Array.isArray(e)||(e=[e]),e.forEach(i=>{if(typeof i=="string"){const n=v("div");n.innerHTML=i,r.append(...n.childNodes)}else r.append(i)})),r}function H(...t){const s=t.reduce((r,i)=>M(M({},r),P(i)),{}),e=[];for(const[r,i]of Object.entries(s))i===""||typeof i>"u"||i===null||e.push(`${r}:${i}`);return e.join(";")}b.exports.formatDate,b.exports.toDate,b.exports.toTwoDigits;const I=(t,s="style")=>t?(t.getAttribute(s)||"").split(/\s?;\s?/).reduce((r,i)=>{const[n,o]=i.split(/\s?:\s?/);return n&&(r[B(n)]=o),r},{}):{},Q=t=>document.createTextNode(t),q="zx-editor__editor",O="SECTION",z="BR",$=[O,"H1","H2","H3","H4","H5","BLOCKQUOTE","UL","OL"],G=["DIV","P","ARTICLE","ASIDE","DETAILS","SUMMARY","FOOTER","HEADER","MAIN","NAV",O,"H1","H2","H3","H4","H5","H6","BLOCKQUOTE"];function C(t,s,e){return t.replace(RegExp("(^<"+s+")|("+s+">$)","gi"),r=>r.toUpperCase().replace(s,e.toLowerCase()))}function x(t){return/^UL|OL$/.test(t.nodeName)}function D(t){if(!t)return!1;const s=w(t.childNodes);return s.length===1&&s[0].nodeName==="BR"}const J=(t,s)=>{const e={minHeight:t.minHeight,"--placeholder":JSON.stringify(t.placeholder),"--placeholder-color":t.placeholderColor,"--line-height":t.lineHeight,"--paragraph-spacing":t.paragraphTailSpacing,"--padding-bottom":t.paddingBottom,...t.styles};t.caretColor&&(e.caretColor=t.caretColor),t.textColor&&(e.color=t.textColor);const r={class:`${q} is-empty`,style:H(e)};return t.editable&&(r.contenteditable="true"),v("div",r,s)},k=(t,s)=>{var f,y,T,p,l,E,m,a,L;if(!t)return null;const e=t.nodeName,r=s.toUpperCase();if(e===r)return null;const i=v(s),n=t.parentElement;let o;if(e==="LI"&&x(n)){if(i.innerHTML=C(t.outerHTML,e,r),o=i.firstChild,n.childElementCount>1)if(n.firstElementChild===t)(f=n.parentElement)==null||f.insertBefore(o,n);else if(n.lastElementChild===t){const d=(y=n.parentElement)==null?void 0:y.nextElementSibling;d?(T=d.parentElement)==null||T.insertBefore(o,d):(p=n.parentElement)==null||p.append(o)}else{const d=w(n.children),c=v(n.nodeName);let g=d.shift();for(;g&&g!==t;)c.append(g),g=d.shift();(l=n.parentElement)==null||l.insertBefore(c,n),(E=n.parentElement)==null||E.insertBefore(o,n),n.removeChild(t)}else(m=n.parentElement)==null||m.insertBefore(o,n),(a=n.parentElement)==null||a.removeChild(n);return o}if(G.includes(e)){if(/UL|OL/.test(r)){const d=t.previousElementSibling,c=t.nextElementSibling;if(d&&x(d)){if(i.innerHTML=C(t.outerHTML,e,"li"),o=i.firstChild,d.append(o),n==null||n.removeChild(t),c&&c.nodeName===d.nodeName){const g=w(c.children);d.append(...g),(L=c.parentElement)==null||L.removeChild(c)}}else c&&x(c)?(i.innerHTML=C(t.outerHTML,e,"li"),o=i.firstChild,c.insertBefore(o,c.firstElementChild),n==null||n.removeChild(t)):(o=i,i.innerHTML=C(t.outerHTML,e,"li"),n==null||n.replaceChild(o,t))}else i.innerHTML=C(t.outerHTML,e,r),o=i.firstChild,n==null||n.replaceChild(o,t);return o}return i.append(t.cloneNode(!0)),n==null||n.replaceChild(i,t),i},U=t=>{t.children.length<=1&&D(t.children[0])?t.classList.add("is-empty"):t.classList.remove("is-empty")};function X(t,s,e=!1){var r;for(;t&&s!==t;){if(!e&&t.nodeName==="LI"&&((r=t.parentElement)==null?void 0:r.parentElement)===s||t.parentElement===s)return t;t=t.parentElement}return s.lastElementChild}const Z={editable:!0,minHeight:"50vh",paddingBottom:"50vh",placeholder:"\u8BF7\u5728\u6B64\u8F93\u5165\u5185\u5BB9..",placeholderColor:"#999",lineHeight:1.5,childNodeName:O,allowedNodeNames:$,paragraphTailSpacing:"10px",caretColor:"",textColor:"#333333",customPasteHandler:void 0,insertTextToNewParagraph:!1},ie="";class ee extends u{constructor(e){super();_(this,"version");_(this,"options");_(this,"$editor");_(this,"_cursorElement",null);_(this,"_eventHandler");_(this,"allowedNodeNames");_(this,"blankLine");_(this,"_pasteHandler");const r=typeof e.container=="string"?Y(e.container):e.container;if(!r)throw new Error(`Can't found '${e.container}' Node in document!`);this.version="1.0.0",this.options={...Z,...e},this.allowedNodeNames=(this.options.allowedNodeNames||$).map(n=>n.toUpperCase());const i=this.options.childNodeName.toUpperCase();this.options.childNodeName=i,this.blankLine=`<${i}><br></${i}>`,this.allowedNodeNames.includes(i)||this.allowedNodeNames.push(i),this.$editor=J(this.options,this.blankLine),r.append(this.$editor),this._eventHandler=n=>{const o=n.type;if(o==="blur"||o==="click"){this._lastLine();const f=window.getSelection(),y=f&&f.rangeCount?f.getRangeAt(f.rangeCount-1).endContainer:n.currentTarget;this.setCursorElement(y)}this.emit(o==="input"?"change":o,n),U(this.$editor)},this._pasteHandler=n=>{var f;if(typeof this.options.customPasteHandler=="function")return this.options.customPasteHandler(n);n.preventDefault();const o=(f=n.clipboardData)==null?void 0:f.getData("text");this._insertText(o)},this._initEvents()}_initEvents(){this.$editor.addEventListener("focus",this._eventHandler),this.$editor.addEventListener("blur",this._eventHandler),this.$editor.addEventListener("input",this._eventHandler),this.$editor.addEventListener("click",this._eventHandler),this.$editor.addEventListener("paste",this._pasteHandler)}use(e,r){typeof e.install=="function"&&e.install(this,r)}setHtml(e){this.$editor.innerHTML=this.blankLine,this.insert(e,!0),this._lastLine(),U(this.$editor)}getHtml(e){const r=this.$editor.innerHTML;if(e)return r;const i=this.options.childNodeName;return r.replace(new RegExp(`(<${i}><br\\s?\\/?><\\/${i}>)+$`,"i"),"")}insert(e,r=!1){if(e instanceof HTMLElement)this._insertEl(e);else{const i=v("div",{},e),n=w(i.childNodes);if(!r&&!this.options.insertTextToNewParagraph&&n.every(o=>o.nodeType===Node.TEXT_NODE))return this._insertText(e);n.forEach(o=>{o.nodeType===Node.ELEMENT_NODE?o.nodeName===z?this._insertEl(v(this.options.childNodeName,{},"<br/>")):this._insertEl(o):o.textContent&&this._insertEl(v(this.options.childNodeName,{},o.textContent))})}this._dispatchChange()}_insertEl(e){const r=this.getCursorElement();D(r)?this.$editor.insertBefore(e,r):this.$editor.insertBefore(e,r.nextElementSibling),this.allowedNodeNames.includes(e.nodeName)||(e=k(e,this.options.childNodeName)),this.setCursorElement(e)}_insertText(e){if(!e)return;const r=window.getSelection(),i=r==null?void 0:r.rangeCount;if(!i)return this.insert(e,!0);r.deleteFromDocument(),r.getRangeAt(0).insertNode(Q(e)),this.setCursorElement(r.getRangeAt(i-1).endContainer),r.collapseToEnd(),this._dispatchChange()}_lastLine(){if(!D(this.$editor.lastElementChild)){const e=this.options.childNodeName;this.$editor.appendChild(v(e,{},"<br>"))}}changeNodeName(e){if(e=(e||this.options.childNodeName).toUpperCase(),!this.allowedNodeNames.includes(e))return!1;const r=this.getCursorElement(),i=k(r,e);return i?(this.setCursorElement(i),this._dispatchChange(),!0):!1}changeStyles(e,r){const i=this.getCursorElement(!0);if(i){const n=I(i);if(e){const o=typeof e=="string"?{[e]:r}:e;i.setAttribute("style",H(n,o))}else{if(!Object.keys(n).length)return;i.removeAttribute("style")}this._dispatchChange()}}_dispatchChange(){this.$editor.dispatchEvent(new InputEvent("input"))}getStyles(){return I(this.getCursorElement())}setCursorElement(e){if(e instanceof Node)for(;e;){if(e.nodeType===Node.ELEMENT_NODE){this._cursorElement=e;break}e=e.parentElement}else e&&(this._cursorElement=e)}getCursorElement(e=!1){return X(this._cursorElement,this.$editor,e)}destroy(){this.$editor.removeEventListener("focus",this._eventHandler),this.$editor.removeEventListener("blur",this._eventHandler),this.$editor.removeEventListener("input",this._eventHandler),this.$editor.removeEventListener("paste",this._pasteHandler),this.removeAllListeners()}}h.ALLOWED_NODE_NAMES=$,h.Editor=ee,Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
