/*!
 * @zx-editor/editor version 1.0.0
 * Author: Capricorncd
 * Released under the MIT License
 * Repository: https://github.com/capricorncd/zx-editor
 * Released on: 2022-07-30 16:59:22 (GMT+0900)
 * Copyright © 2018-present, Capricorncd
 */
(function(f,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(f=typeof globalThis<"u"?globalThis:f||self,u(f.Editor={}))})(this,function(f){"use strict";var re=Object.defineProperty;var ne=(f,u,y)=>u in f?re(f,u,{enumerable:!0,configurable:!0,writable:!0,value:y}):f[u]=y;var m=(f,u,y)=>(ne(f,typeof u!="symbol"?u+"":u,y),y);class u{constructor(){this._events={}}on(i,e){return!i||!e||typeof e!="function"?this:(this._events[i]||(this._events[i]=[]),this._events[i].push(e),this)}once(i,e){const n=(...s)=>{e.apply(this,s),this.off(i,n)};return this.on(i,n)}emit(i,...e){const n=this._events[i];if(!n)return this;for(let s=0;s<n.length;s++)try{n[s].apply(this,e)}catch(r){this.emit("error",r,"emit")}return this}off(i,e){if(!this._events[i])return this;const n=this._events[i];if(typeof e=="function"){const s=n.findIndex(r=>r===e);s>=0&&n.splice(s,1)}else this._events[i].length=0;return this._removeEmpty(i),this}_removeEmpty(i){this._events[i].length||delete this._events[i]}removeAllListeners(){Object.keys(this._events).forEach(i=>this.off(i))}}/*!
 * zx-sml version 0.2.1
 * Author: Capricorncd <capricorncd@qq.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2022-07-24 15:34:05 (GMT+0900)
 */var y=Object.defineProperty,x=Object.getOwnPropertySymbols,V=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable,D=(t,i,e)=>i in t?y(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e,M=(t,i)=>{for(var e in i||(i={}))V.call(i,e)&&D(t,e,i[e]);if(x)for(var e of x(i))Y.call(i,e)&&D(t,e,i[e]);return t};function K(t){return Array.isArray(t)}function A(t){return t!==null&&!K(t)&&typeof t=="object"}var W=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},N={exports:{}};/*! For license information please see date-utils-2020.js.LICENSE.txt */(function(t,i){(function(e,n){t.exports=n()})(typeof self<"u"?self:W,function(){return(()=>{var e={949:(s,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.toTwoDigits=void 0,r.toTwoDigits=function(o){return o[1]?o:"0"+o}},607:(s,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.toTwoDigits=r.toDate=r.formatDate=void 0;var v=o(949);Object.defineProperty(r,"toTwoDigits",{enumerable:!0,get:function(){return v.toTwoDigits}});var b={weeks:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]};function w(h){if(h instanceof Date)return h;if(typeof h=="number")return new Date(h);if(typeof h=="string"){var l=h.trim();if(/^\d+$/.test(l)){var g=l.length;return g===8?new Date([l.substr(0,4),l.substr(4,2),l.substr(6,2)].join("/")):g===6?new Date([l.substr(0,4),l.substr(4,2),"01"].join("/")):g===4?new Date(l+"/01/01"):new Date(parseInt(h))}if(l=l.replace(/[年月日]/g,function(a){return a==="\u65E5"?"":"/"}).replace(/[(（（].*?[)））]/g," ").replace(/\bam|pm\b/gi," ").replace(/\s+/g," "),/^(\d{4})[-/](\d{1,2})[-/](\d{1,2})$/.test(l))return new Date([RegExp.$1,RegExp.$2,RegExp.$3].join("/"));if(/^(\d{4})[-/](\d{1,2})$/.test(l))return new Date([RegExp.$1,RegExp.$2,"01"].join("/"));var p=new Date(l);return isNaN(p.getFullYear())?null:p}return null}r.formatDate=function(h,l,g){var p,a=w(h);if(!a||!l)return h+"";if(l==="timestamp")return a.getTime().toString();/(y+)/i.test(l)&&(p=RegExp.$1,l=l.replace(p,(a.getFullYear()+"").substr(4-p.length))),g&&Array.isArray(g.weeks)||(g=b);var L={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"w+":a.getDay(),"W+":g.weeks[a.getDay()],"a+":a.getHours()<12?"am":"pm","A+":a.getHours()<12?"AM":"PM"};for(var c in L)if(new RegExp("("+c+")").test(l)){p=RegExp.$1;var d=L[c]+"";l=l.replace(p,p.length===1?d:v.toTwoDigits(d))}if(/(g)/i.test(l)){var _=a.toString().split(/\s+/).slice(5),te=l.includes("g");l=l.replace(/g/i,te?_[0]:_.join(" "))}return l},r.toDate=w}},n={};return function s(r){if(n[r])return n[r].exports;var o=n[r]={exports:{}};return e[r](o,o.exports,s),o.exports}(607)})()})})(N);function R(t="",i="-"){return t.replace(/[A-Z]/g,(e,n)=>`${n>0?i:""}${e.toLowerCase()}`)}function j(t="",i=!1){const e=t.replace(/[-_\s](\w)/g,(n,s)=>s.toUpperCase());return i?e.replace(/^\w/,n=>n.toUpperCase()):e}function H(t,i=0){return Array.prototype.slice.call(t,i)}function I(t={},i=!1){const e=i?j:R,n={};for(const[s,r]of Object.entries(t))n[e(s)]=A(r)?I(r,i):r;return n}function B(t,i=document){return t?t instanceof HTMLElement?t:i.querySelector(t):null}function E(t,i={},e){const n=document.createElement(t);for(const[s,r]of Object.entries(i))n.setAttribute(R(s),s==="style"&&A(r)?O(r):r);return e&&(Array.isArray(e)||(e=[e]),e.forEach(s=>{if(typeof s=="string"){const r=E("div");r.innerHTML=s,n.append(...r.childNodes)}else n.append(s)})),n}function O(...t){const i=t.reduce((n,s)=>M(M({},n),I(s)),{}),e=[];for(const[n,s]of Object.entries(i))s===""||typeof s>"u"||s===null||e.push(`${n}:${s}`);return e.join(";")}N.exports.formatDate,N.exports.toDate,N.exports.toTwoDigits;const P="zx-editor__editor",T="SECTION",Q="BR",U=["SECTION","H1","H2","H3","H4","H5","BLOCKQUOTE","UL","OL"],q=["DIV","P","ARTICLE","ASIDE","DETAILS","SUMMARY","FOOTER","HEADER","MAIN","NAV","SECTION","H1","H2","H3","H4","H5","H6","BLOCKQUOTE"];class z{constructor(i){m(this,"rootElement");m(this,"timer");m(this,"selection");m(this,"range",new Range);var n;this.rootElement=i,this.timer=null,this.selection=window.getSelection();const e=i.lastElementChild;e&&this.setRange(e,(n=e.textContent)==null?void 0:n.length)}_getLastNode(i){let e=i;for(;e.lastChild;)e=e.lastChild;return e}setRange(i,e){var s,r,o;if(this.selection)this.selection.removeAllRanges();else{this.selection=window.getSelection();try{this.range=(s=this.selection)==null?void 0:s.getRangeAt(0)}catch{this.range=new Range}}let n;i?n=this._getLastNode(i):n=this.range.endContainer,console.log(n),typeof e>"u"&&(e=(o=(r=n.textContent)==null?void 0:r.length)!=null?o:0),this.range.setStart(n,e),this.range.collapse(!0),this._clearTimeout(),this.timer=setTimeout(()=>{var v;(v=this.selection)==null||v.addRange(this.range)},100)}_clearTimeout(){this.timer&&(clearTimeout(this.timer),this.timer=null)}getCurrentNode(i=!1){var n;let e=this.range.endContainer;for(;e&&this.rootElement!==e;){if(!i&&e.nodeName==="LI"&&((n=e.parentElement)==null?void 0:n.parentElement)===this.rootElement||e.parentElement===this.rootElement)return e;e=e.parentNode}return this.rootElement.lastElementChild}}function C(t,i,e){return t.replace(RegExp("(^<"+i+")|("+i+">$)","gi"),n=>n.toUpperCase().replace(i,e.toLowerCase()))}function S(t){return/UL|OL/.test(t.nodeName)}function $(t){if(!t)return!1;const i=H(t.childNodes);return i.length===1&&i[0].nodeName==="BR"}function k(t,i="style"){return t?(t.getAttribute(i)||"").split(/\s?;\s?/).reduce((n,s)=>{const[r,o]=s.split(/\s?:\s?/);return r&&(n[j(r)]=o),n},{}):{}}const G=t=>{var n;const i=`.${P}.is-empty:before{content:'${t}' !important;`,e=E("style",{type:"text/css"},i);(n=B("head"))==null||n.append(e)},Z=t=>{const i={lineHeight:t.lineHeight,minHeight:t.minHeight,position:"relative",overflowY:"scroll",outline:"none",...t.styles,"--placeholder-color":t.placeholderColor,"--line-height":t.lineHeight};G(t.placeholder),t.caretColor&&(i.caretColor=t.caretColor),t.textColor&&(i.color=t.textColor);const e={class:`${P} is-empty`,style:O(i)};t.editable&&(e.contenteditable="true");const n=E("div",e);return n.innerHTML="<section><br></section>",n},F=(t,i=T)=>{var v,b,w,h,l,g,p,a,L;if(!t)return null;const e=t.nodeName,n=i.toUpperCase();if(e===n)return t;const s=E(i),r=t.parentElement;let o;if(e==="LI"&&S(r)){if(s.innerHTML=C(t.outerHTML,e,n),o=s.firstChild,r.childElementCount>1)if(r.firstElementChild===t)(v=r.parentElement)==null||v.insertBefore(o,r);else if(r.lastElementChild===t){const c=(b=r.parentElement)==null?void 0:b.nextElementSibling;c?(w=c.parentElement)==null||w.insertBefore(o,c):(h=r.parentElement)==null||h.append(o)}else{const c=H(r.children),d=E(r.nodeName);let _=c.shift();for(;_&&_!==t;)d.append(_),_=c.shift();(l=r.parentElement)==null||l.insertBefore(d,r),(g=r.parentElement)==null||g.insertBefore(o,r),r.removeChild(t)}else(p=r.parentElement)==null||p.insertBefore(o,r),(a=r.parentElement)==null||a.removeChild(r);return o}if(q.includes(e)){if(/UL|OL/.test(n)){const c=t.previousElementSibling,d=t.nextElementSibling;if(c&&S(c)){if(s.innerHTML=C(t.outerHTML,e,"li"),o=s.firstChild,c.append(o),r==null||r.removeChild(t),d&&d.nodeName===c.nodeName){const _=H(d.children);c.append(..._),(L=d.parentElement)==null||L.removeChild(d)}}else d&&S(d)?(s.innerHTML=C(t.outerHTML,e,"li"),o=s.firstChild,d.insertBefore(o,d.firstElementChild),r==null||r.removeChild(t)):(o=s,s.innerHTML=C(t.outerHTML,e,"li"),r==null||r.replaceChild(o,t))}else s.innerHTML=C(t.outerHTML,e,n),o=s.firstChild,r==null||r.replaceChild(o,t);return o}return s.append(t.cloneNode(!0)),r==null||r.replaceChild(s,t),s},J=t=>{t.children.length<=1&&$(t.children[0])?t.classList.add("is-empty"):t.classList.remove("is-empty")},X={editable:!0,minHeight:"50vh",placeholder:"\u8BF7\u5728\u6B64\u8F93\u5165\u5185\u5BB9..",placeholderColor:"#999",lineHeight:1.5,allowedNodeNames:U,paragraphTailSpacing:"10px",caretColor:"",textColor:"",customPasteHandler:void 0},ie="";class ee extends u{constructor(e){super();m(this,"version");m(this,"options");m(this,"$editor");m(this,"cursor");m(this,"_eventHandler");m(this,"allowedNodeNames");const n=typeof e.container=="string"?B(e.container):e.container;if(!n)throw new Error(`Can't found '${e.container}' Node in document!`);this.version="1.0.0",this.options={...X,...e},this.allowedNodeNames=(this.options.allowedNodeNames||U).map(s=>s.toUpperCase()),this.$editor=Z(this.options),n.append(this.$editor),this.cursor=new z(this.$editor),this._eventHandler=s=>{const r=s.type;r==="blur"&&this._lastLine(),this.emit(r==="input"?"change":r,s),J(this.$editor),r==="click"&&this.cursor.setRange(s.target)},this._initEvents()}_initEvents(){this.$editor.addEventListener("focus",this._eventHandler),this.$editor.addEventListener("blur",this._eventHandler),this.$editor.addEventListener("input",this._eventHandler),this.$editor.addEventListener("click",this._eventHandler)}use(e,n){typeof e.install=="function"&&e.install(this,n)}setHtml(e){this.$editor.innerHTML="",this.insert(e),this._lastLine()}getHtml(){return this.$editor.innerHTML.replace(/<section><br><\/section>$/,"")}insert(e){if(e instanceof HTMLElement)this._insert(e);else{const n=E("div");n.innerHTML=e,H(n.childNodes).forEach(s=>{s.nodeType===Node.ELEMENT_NODE?s.nodeName===Q?this._insert(E(T,{},"<br/>")):this._insert(s):s.textContent&&this._insert(E(T,{},s.textContent))})}this._dispatchChange()}_insert(e){const n=this.getCurrentNode();n?$(n)?this.$editor.insertBefore(e,n):this.$editor.insertBefore(e,n.nextElementSibling):this.$editor.append(e),this.allowedNodeNames.includes(e.nodeName)||(e=F(e,T)),this.cursor.setRange(e)}_lastLine(){$(this.$editor.lastElementChild)||this.$editor.appendChild(E("section",{},"<br>"))}changeNodeName(e){if(!this.allowedNodeNames.includes(e.toUpperCase()))return!1;const n=this.getCurrentNode(),s=F(n,e);return s?(this.cursor.setRange(s),this._dispatchChange(),!0):!1}changeStyles(e,n){const s=this.getCurrentNode(!0);if(s){const r=typeof e=="string"?{[e]:n}:e;s.setAttribute("style",O(k(s),r)),this._dispatchChange()}}_dispatchChange(){this.$editor.dispatchEvent(new InputEvent("input"))}getStyles(){return k(this.getCurrentNode())}getCurrentNode(e=!1){return this.cursor.getCurrentNode(e)}destroy(){this.$editor.removeEventListener("focus",this._eventHandler),this.$editor.removeEventListener("blur",this._eventHandler),this.$editor.removeEventListener("input",this._eventHandler),this.removeAllListeners()}}f.Editor=ee,Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
