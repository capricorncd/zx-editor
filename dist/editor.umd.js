/*!
 * @sp-editor/editor version 1.0.0
 * Author: Capricorncd
 * Released under the MIT License
 * Repository: https://github.com/capricorncd/zx-editor
 * Copyright © 2018-present, Capricorncd/ Xing Zhong.
 */
(function(a,c){typeof exports=="object"&&typeof module<"u"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(a=typeof globalThis<"u"?globalThis:a||self,c(a.Editor={}))})(this,function(a){"use strict";var re=Object.defineProperty;var ie=(a,c,p)=>c in a?re(a,c,{enumerable:!0,configurable:!0,writable:!0,value:p}):a[c]=p;var m=(a,c,p)=>(ie(a,typeof c!="symbol"?c+"":c,p),p);class c{constructor(){this._events={}}on(r,e){return!r||!e||typeof e!="function"?this:(this._events[r]||(this._events[r]=[]),this._events[r].push(e),this)}once(r,e){const n=(...i)=>{e.apply(this,i),this.off(r,n)};return this.on(r,n)}emit(r,...e){const n=this._events[r];if(!n)return this;for(let i=0;i<n.length;i++)try{n[i].apply(this,e)}catch(s){this.emit("error",s,"emit")}return this}off(r,e){if(!this._events[r])return this;const n=this._events[r];if(typeof e=="function"){const i=n.findIndex(s=>s===e);i>=0&&n.splice(i,1)}else this._events[r].length=0;return this._removeEmpty(r),this}_removeEmpty(r){this._events[r].length||delete this._events[r]}removeAllListeners(){Object.keys(this._events).forEach(r=>this.off(r))}}/*!
 * zx-sml version 0.7.5
 * Author: Capricorncd <capricorncd@qq.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2023-05-17 20:41:58 (GMT+0900)
 */var p=Object.defineProperty,L=Object.getOwnPropertySymbols,W=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,T=(t,r,e)=>r in t?p(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,H=(t,r)=>{for(var e in r||(r={}))W.call(r,e)&&T(t,e,r[e]);if(L)for(var e of L(r))K.call(r,e)&&T(t,e,r[e]);return t};function q(t){return Array.isArray(t)}function $(t){return typeof t=="object"&&t!==null&&!q(t)}function b(t="",r="-"){return t.replace(/[A-Z]/g,(e,n)=>`${n>0?r:""}${e.toLowerCase()}`)}function O(t="",r=!1){const e=t.replace(/[-_\s](\w)/g,(n,i)=>i.toUpperCase());return r?e.replace(/^\w/,n=>n.toUpperCase()):e}function g(t,r=0){return Array.prototype.slice.call(t,r)}function S(t={},r=!1){const e=r?O:b,n={};for(const[i,s]of Object.entries(t))n[e(i)]=$(s)?S(s,r):s;return n}function G(t,r=document){return t?t instanceof HTMLElement?t:r.querySelector(t):null}function d(t,r={},e){const n=document.createElement(t);for(const[i,s]of Object.entries(r))n.setAttribute(b(i),i==="style"&&$(s)?_(s):String(s));return e&&(Array.isArray(e)||(e=[e]),e.forEach(i=>{if(typeof i=="string"){const s=d("div");s.innerHTML=i,n.append(...s.childNodes)}else n.append(i)})),n}function _(...t){const r=t.reduce((n,i)=>H(H({},n),S(i)),{}),e=[];for(const[n,i]of Object.entries(r))i===""||typeof i>"u"||i===null||e.push(`${n}:${i}`);return e.join(";")}const w=(t,r="style")=>t?(t.getAttribute(r)||"").split(/\s?;\s?/).reduce((n,i)=>{const[s,o]=i.split(/\s?:\s?/);return s&&(n[O(s)]=o),n},{}):{},J=t=>document.createTextNode(t),Q="sp-editor__editor",x="SECTION",X="BR",C=[x,"H1","H2","H3","H4","H5","BLOCKQUOTE","UL","OL"];function N(t,r,e){return t.replace(RegExp("(^<"+r+")|("+r+">$)","gi"),n=>n.toUpperCase().replace(r,e.toLowerCase()))}function Z(t){return t.replace(/<li[^>]*>(.+)<\/li>/gi,"$1")}function v(t){const r=typeof t=="string"?t:t.nodeName;return/^UL|OL$/i.test(r)}function M(t){if(!t)return!1;const r=g(t.childNodes);return r.length===1&&r[0].nodeName==="BR"}function y(t){return t instanceof Element&&(t=t.outerHTML),/^<(\w+)[^>]*>.*<\/\1>$/.test(t)}function A(t){return["PICTURE","VIDEO","AUDIO","CANVAS"].includes(t.nodeName)}function z(t){return["IMG"].includes(t.nodeName)||A(t)}function D(t){if(z(t))return!0;for(let r=0;r<t.children.length;r++)if(D(t.children[r]))return!0;return!1}const Y=(t,r)=>{const e={minHeight:t.minHeight,"--placeholder":JSON.stringify(t.placeholder),"--placeholder-color":t.placeholderColor,"--line-height":t.lineHeight,"--paragraph-spacing":t.paragraphTailSpacing,"--padding-bottom":`calc(${t.paddingBottom||"0px"} + env(safe-area-inset-bottom))`,...t.styles};t.caretColor&&(e.caretColor=t.caretColor),t.textColor&&(e.color=t.textColor);const n={class:`${Q} is-empty`,style:_(e)};return t.editable&&(n.contenteditable="true"),d("div",n,r)},P=(t,r)=>{var l,h,I,k,U,j,R,V,F;if(!t)return null;const e=t.nodeName,n=r.toUpperCase();if(e===n)return null;const i=d(r),s=t.parentElement;let o;if(e==="LI"&&v(s)){if(i.innerHTML=N(t.outerHTML,e,n),o=i.firstChild,s.childElementCount>1)if(s.firstElementChild===t)(l=s.parentElement)==null||l.insertBefore(o,s);else if(s.lastElementChild===t){const f=(h=s.parentElement)==null?void 0:h.nextElementSibling;f?(I=f.parentElement)==null||I.insertBefore(o,f):(k=s.parentElement)==null||k.append(o)}else{const f=g(s.children),u=d(s.nodeName);let E=f.shift();for(;E&&E!==t;)u.append(E),E=f.shift();(U=s.parentElement)==null||U.insertBefore(u,s),(j=s.parentElement)==null||j.insertBefore(o,s),s.removeChild(t)}else(R=s.parentElement)==null||R.insertBefore(o,s),(V=s.parentElement)==null||V.removeChild(s);return o}if(/UL|OL/.test(n)){const f=t.previousElementSibling,u=t.nextElementSibling;if(f&&v(f)){if(i.innerHTML=N(t.outerHTML,e,"li"),o=i.firstChild,f.append(o),s==null||s.removeChild(t),u&&u.nodeName===f.nodeName){const E=g(u.children);f.append(...E),(F=u.parentElement)==null||F.removeChild(u)}}else u&&v(u)?(i.innerHTML=N(t.outerHTML,e,"li"),o=i.firstChild,u.insertBefore(o,u.firstElementChild),s==null||s.removeChild(t)):(o=i,i.innerHTML=N(t.outerHTML,e,"li"),s==null||s.replaceChild(o,t))}else i.innerHTML=Z(N(t.outerHTML,e,n)),o=i.firstChild,s==null||s.replaceChild(o,t);return o},B=t=>{var r;!((r=t.innerText)!=null&&r.trim())&&!D(t)?t.classList.add("is-empty"):t.classList.remove("is-empty")};function ee(t,r,e=!1){var n;for(;t&&r!==t;){if(!e&&t.nodeName==="LI"&&((n=t.parentElement)==null?void 0:n.parentElement)===r||t.parentElement===r)return t;t=t.parentElement}return r.lastElementChild}const te={editable:!0,minHeight:"50vh",paddingBottom:"50vh",placeholder:"请在此输入内容..",placeholderColor:"#999",lineHeight:1.5,childNodeName:x,allowedNodeNames:C,paragraphTailSpacing:"10px",caretColor:"",textColor:"#333333",customPasteHandler:void 0,insertTextToNewParagraph:!1},se="";class ne extends c{constructor(e){super();m(this,"version");m(this,"options");m(this,"$editor");m(this,"_cursorElement",null);m(this,"_eventHandler");m(this,"allowedNodeNames");m(this,"blankLine");m(this,"_pasteHandler");const n=typeof e.container=="string"?G(e.container):e.container;if(!n)throw new Error(`Can't found '${e.container}' Node in document!`);this.version="1.0.0",this.options={...te,...e},this.allowedNodeNames=(this.options.allowedNodeNames||C).map(s=>s.toUpperCase());const i=this.options.childNodeName.toUpperCase();this.options.childNodeName=i,this.blankLine=`<${i}><br></${i}>`,this.allowedNodeNames.includes(i)||this.allowedNodeNames.push(i),this.$editor=Y(this.options,this.blankLine),n.append(this.$editor),this._eventHandler=s=>{const o=s.type;if(o==="blur"||o==="click"){const l=window.getSelection(),h=l&&l.rangeCount?l.getRangeAt(l.rangeCount-1).endContainer:s.currentTarget;this.setCursorElement(h),o==="blur"&&this._verifyChild()}this.emit(o==="input"?"change":o,s),B(this.$editor)},this._pasteHandler=s=>{var l;if(typeof this.options.customPasteHandler=="function")return this.options.customPasteHandler(s);s.preventDefault();const o=(l=s.clipboardData)==null?void 0:l.getData("text");this._insertText(o)},this._initEvents()}_initEvents(){this.$editor.addEventListener("focus",this._eventHandler),this.$editor.addEventListener("blur",this._eventHandler),this.$editor.addEventListener("input",this._eventHandler),this.$editor.addEventListener("click",this._eventHandler),this.$editor.addEventListener("paste",this._pasteHandler)}use(e,n){typeof e.install=="function"&&e.install(this,n)}setHtml(e){this.$editor.innerHTML=this.blankLine,this.insert(e,!0),B(this.$editor)}getHtml(e){const n=this.$editor.innerHTML;if(e)return n;const i=this.options.childNodeName;return n.replace(new RegExp(`(<${i}><br\\s?\\/?><\\/${i}>)+$`,"i"),"")}insert(e,n=!1){const{childNodeName:i,insertTextToNewParagraph:s}=this.options;if(e instanceof HTMLElement)this._insertEl(e);else{const o=d("div",{},e),l=g(o.childNodes);if(!n&&!s&&l.every(h=>h.nodeType===Node.TEXT_NODE))return this._insertText(e);l.forEach(h=>{h.nodeType===Node.ELEMENT_NODE?h.nodeName===X?this._insertEl(d(i,{},"<br/>")):this._insertEl(h):h.textContent&&this._insertEl(d(i,{},h.textContent))})}this._dispatchChange()}_insertEl(e){const n=this.getCursorElement();M(n)?y(e.outerHTML)?this.$editor.insertBefore(e,n):n===this.$editor.children[this.$editor.children.length-1]?this.$editor.insertBefore(d(this.options.childNodeName,{},e),n):(n.innerHTML="",n.append(e)):(y(e.outerHTML)||(e=d(this.options.childNodeName,{},e)),n.nextElementSibling?this.$editor.insertBefore(e,n.nextElementSibling):this.$editor.append(e)),this.setCursorElement(e)}_insertText(e){if(!e)return;const n=window.getSelection(),i=n==null?void 0:n.rangeCount;if(!i)return this.insert(e,!0);n.deleteFromDocument(),n.getRangeAt(0).insertNode(J(e)),this.setCursorElement(n.getRangeAt(i-1).endContainer),n.collapseToEnd(),this._dispatchChange()}_verifyChild(){const e=this.getCursorElement(!0),n=this.options.childNodeName;let i,s=!1,o=0;for(;o<this.$editor.childNodes.length;)if(i=this.$editor.childNodes[o++],i.nodeType===Node.ELEMENT_NODE){if(y(i)){if(this.allowedNodeNames.includes(i.nodeName))continue;if(s=e===i,!A(i)){const l=P(i,n);s&&l&&this.setCursorElement(l);continue}}i.replaceWith(d(n,{},i.cloneNode(!0)))}else{const l=d(n,{},i.cloneNode(!0));this.$editor.replaceChild(l,i)}M(this.$editor.lastElementChild)||this.$editor.appendChild(d(n,{},"<br>"))}changeNodeName(e){if(e=(e||this.options.childNodeName).toUpperCase(),!this.allowedNodeNames.includes(e))return!1;const n=this.getCursorElement(),i=P(n,e);return i?(this.setCursorElement(i),this._dispatchChange(),!0):!1}changeStyles(e,n){const i=this.getCursorElement(!0);if(i){const s=w(i);if(e){const o=typeof e=="string"?{[e]:n}:e;i.setAttribute("style",_(s,o))}else{if(!Object.keys(s).length)return;i.removeAttribute("style")}this._dispatchChange()}}_dispatchChange(){this.$editor.dispatchEvent(new InputEvent("input"))}getStyles(){return w(this.getCursorElement())}setCursorElement(e){if(e instanceof Node)for(;e;){if(e.nodeType===Node.ELEMENT_NODE){this._cursorElement=e;break}e=e.parentElement}else e&&(this._cursorElement=e)}getCursorElement(e=!1){return ee(this._cursorElement,this.$editor,e)}destroy(){this.$editor.removeEventListener("focus",this._eventHandler),this.$editor.removeEventListener("blur",this._eventHandler),this.$editor.removeEventListener("input",this._eventHandler),this.$editor.removeEventListener("paste",this._pasteHandler),this.removeAllListeners()}}a.ALLOWED_NODE_NAMES=C,a.Editor=ne,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
