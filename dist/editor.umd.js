/*!
 * @sp-editor/editor version 1.0.0
 * Author: Capricorncd
 * Released under the MIT License
 * Repository: https://github.com/capricorncd/zx-editor
 * Copyright © 2018-present, Capricorncd/ Xing Zhong.
 */
(function(d,c){typeof exports=="object"&&typeof module<"u"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(d=typeof globalThis<"u"?globalThis:d||self,c(d.Editor={}))})(this,function(d){"use strict";var re=Object.defineProperty;var ie=(d,c,p)=>c in d?re(d,c,{enumerable:!0,configurable:!0,writable:!0,value:p}):d[c]=p;var m=(d,c,p)=>(ie(d,typeof c!="symbol"?c+"":c,p),p);class c{constructor(){this._events={}}on(r,e){return!r||!e||typeof e!="function"?this:(this._events[r]||(this._events[r]=[]),this._events[r].push(e),this)}once(r,e){const n=(...i)=>{e.apply(this,i),this.off(r,n)};return this.on(r,n)}emit(r,...e){const n=this._events[r];if(!n)return this;for(let i=0;i<n.length;i++)try{n[i].apply(this,e)}catch(s){this.emit("error",s,"emit")}return this}off(r,e){if(!this._events[r])return this;const n=this._events[r];if(typeof e=="function"){const i=n.findIndex(s=>s===e);i>=0&&n.splice(i,1)}else this._events[r].length=0;return this._removeEmpty(r),this}_removeEmpty(r){this._events[r].length||delete this._events[r]}removeAllListeners(){Object.keys(this._events).forEach(r=>this.off(r))}}/*!
 * zx-sml version 0.7.5
 * Author: Capricorncd <capricorncd@qq.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2023-05-17 20:41:58 (GMT+0900)
 */var p=Object.defineProperty,L=Object.getOwnPropertySymbols,F=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,T=(t,r,e)=>r in t?p(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,H=(t,r)=>{for(var e in r||(r={}))F.call(r,e)&&T(t,e,r[e]);if(L)for(var e of L(r))K.call(r,e)&&T(t,e,r[e]);return t};function W(t){return Array.isArray(t)}function $(t){return typeof t=="object"&&t!==null&&!W(t)}function b(t="",r="-"){return t.replace(/[A-Z]/g,(e,n)=>`${n>0?r:""}${e.toLowerCase()}`)}function O(t="",r=!1){const e=t.replace(/[-_\s](\w)/g,(n,i)=>i.toUpperCase());return r?e.replace(/^\w/,n=>n.toUpperCase()):e}function g(t,r=0){return Array.prototype.slice.call(t,r)}function S(t={},r=!1){const e=r?O:b,n={};for(const[i,s]of Object.entries(t))n[e(i)]=$(s)?S(s,r):s;return n}function q(t,r=document){return t?t instanceof HTMLElement?t:r.querySelector(t):null}function u(t,r={},e){const n=document.createElement(t);for(const[i,s]of Object.entries(r))n.setAttribute(b(i),i==="style"&&$(s)?_(s):String(s));return e&&(Array.isArray(e)||(e=[e]),e.forEach(i=>{if(typeof i=="string"){const s=u("div");s.innerHTML=i,n.append(...s.childNodes)}else n.append(i)})),n}function _(...t){const r=t.reduce((n,i)=>H(H({},n),S(i)),{}),e=[];for(const[n,i]of Object.entries(r))i===""||typeof i>"u"||i===null||e.push(`${n}:${i}`);return e.join(";")}const w=(t,r="style")=>t?(t.getAttribute(r)||"").split(/\s?;\s?/).reduce((n,i)=>{const[s,o]=i.split(/\s?:\s?/);return s&&(n[O(s)]=o),n},{}):{},G=t=>document.createTextNode(t),J="sp-editor__editor",M="SECTION",Q="BR",C=[M,"H1","H2","H3","H4","H5","BLOCKQUOTE","UL","OL"];function N(t,r,e){return t.replace(RegExp("(^<"+r+")|("+r+">$)","gi"),n=>n.toUpperCase().replace(r,e.toLowerCase()))}function X(t){return t.replace(/<li[^>]*>(.+)<\/li>/gi,"$1")}function v(t){const r=typeof t=="string"?t:t.nodeName;return/^UL|OL$/i.test(r)}function x(t){if(!t)return!1;const r=g(t.childNodes);return r.length===1&&r[0].nodeName==="BR"}function y(t){return t instanceof Element&&(t=t.outerHTML),/^<(\w+)[^>]*>.*<\/\1>$/.test(t)}function Z(t){return["PICTURE","VIDEO","AUDIO","CANVAS"].includes(t.nodeName)}function z(t){return["IMG"].includes(t.nodeName)||Z(t)}function A(t){if(z(t))return!0;for(let r=0;r<t.children.length;r++)if(A(t.children[r]))return!0;return!1}const Y=(t,r)=>{const e={minHeight:t.minHeight,"--placeholder":JSON.stringify(t.placeholder),"--placeholder-color":t.placeholderColor,"--line-height":t.lineHeight,"--paragraph-spacing":t.paragraphTailSpacing,"--padding-bottom":`calc(${t.paddingBottom||"0px"} + env(safe-area-inset-bottom))`,...t.styles};t.caretColor&&(e.caretColor=t.caretColor),t.textColor&&(e.color=t.textColor);const n={class:`${J} is-empty`,style:_(e)};return t.editable&&(n.contenteditable="true"),u("div",n,r)},D=(t,r)=>{var l,a,B,I,k,U,j,R,V;if(!t)return null;const e=t.nodeName,n=r.toUpperCase();if(e===n)return null;const i=u(r),s=t.parentElement;let o;if(e==="LI"&&v(s)){if(i.innerHTML=N(t.outerHTML,e,n),o=i.firstChild,s.childElementCount>1)if(s.firstElementChild===t)(l=s.parentElement)==null||l.insertBefore(o,s);else if(s.lastElementChild===t){const h=(a=s.parentElement)==null?void 0:a.nextElementSibling;h?(B=h.parentElement)==null||B.insertBefore(o,h):(I=s.parentElement)==null||I.append(o)}else{const h=g(s.children),f=u(s.nodeName);let E=h.shift();for(;E&&E!==t;)f.append(E),E=h.shift();(k=s.parentElement)==null||k.insertBefore(f,s),(U=s.parentElement)==null||U.insertBefore(o,s),s.removeChild(t)}else(j=s.parentElement)==null||j.insertBefore(o,s),(R=s.parentElement)==null||R.removeChild(s);return o}if(/UL|OL/.test(n)){const h=t.previousElementSibling,f=t.nextElementSibling;if(h&&v(h)){if(i.innerHTML=N(t.outerHTML,e,"li"),o=i.firstChild,h.append(o),s==null||s.removeChild(t),f&&f.nodeName===h.nodeName){const E=g(f.children);h.append(...E),(V=f.parentElement)==null||V.removeChild(f)}}else f&&v(f)?(i.innerHTML=N(t.outerHTML,e,"li"),o=i.firstChild,f.insertBefore(o,f.firstElementChild),s==null||s.removeChild(t)):(o=i,i.innerHTML=N(t.outerHTML,e,"li"),s==null||s.replaceChild(o,t))}else i.innerHTML=X(N(t.outerHTML,e,n)),o=i.firstChild,s==null||s.replaceChild(o,t);return o},P=t=>{var r;!((r=t.innerText)!=null&&r.trim())&&!A(t)?t.classList.add("is-empty"):t.classList.remove("is-empty")};function ee(t,r,e=!1){var n;for(;t&&r!==t;){if(!e&&t.nodeName==="LI"&&((n=t.parentElement)==null?void 0:n.parentElement)===r||t.parentElement===r)return t;t=t.parentElement}return r.lastElementChild}const te={editable:!0,minHeight:"50vh",paddingBottom:"50vh",placeholder:"请在此输入内容..",placeholderColor:"#999",lineHeight:1.5,childNodeName:M,allowedNodeNames:C,paragraphTailSpacing:"10px",caretColor:"",textColor:"#333333",customPasteHandler:void 0,insertTextToNewParagraph:!1},se="";class ne extends c{constructor(e){super();m(this,"version");m(this,"options");m(this,"$editor");m(this,"_cursorElement",null);m(this,"_eventHandler");m(this,"allowedNodeNames");m(this,"blankLine");m(this,"_pasteHandler");const n=typeof e.container=="string"?q(e.container):e.container;if(!n)throw new Error(`Can't found '${e.container}' Node in document!`);this.version="1.0.0",this.options={...te,...e},this.allowedNodeNames=(this.options.allowedNodeNames||C).map(s=>s.toUpperCase());const i=this.options.childNodeName.toUpperCase();this.options.childNodeName=i,this.blankLine=`<${i}><br></${i}>`,this.allowedNodeNames.includes(i)||this.allowedNodeNames.push(i),this.$editor=Y(this.options,this.blankLine),n.append(this.$editor),this._eventHandler=s=>{const o=s.type;if(o==="blur"||o==="click"){const l=window.getSelection(),a=l&&l.rangeCount?l.getRangeAt(l.rangeCount-1).endContainer:s.currentTarget;this.setCursorElement(a),o==="blur"&&this._verifyChild()}this.emit(o==="input"?"change":o,s),P(this.$editor)},this._pasteHandler=s=>{var l;if(typeof this.options.customPasteHandler=="function")return this.options.customPasteHandler(s);s.preventDefault();const o=(l=s.clipboardData)==null?void 0:l.getData("text");this.insert(o)},this._initEvents()}_initEvents(){this.$editor.addEventListener("focus",this._eventHandler),this.$editor.addEventListener("blur",this._eventHandler),this.$editor.addEventListener("input",this._eventHandler),this.$editor.addEventListener("click",this._eventHandler),this.$editor.addEventListener("paste",this._pasteHandler)}use(e,n){typeof e.install=="function"&&e.install(this,n)}setHtml(e){this.$editor.innerHTML=this.blankLine,this.insert(e,!0),P(this.$editor)}getHtml(e){const n=this.$editor.innerHTML;if(e)return n;const i=this.options.childNodeName;return n.replace(new RegExp(`(<${i}><br\\s?\\/?><\\/${i}>)+$`,"i"),"")}insert(e,n=!1){if(!e)return;const{childNodeName:i,insertTextToNewParagraph:s}=this.options;if(e instanceof HTMLElement)this._insertEl(e);else{const o=u("div",{},e),l=g(o.childNodes);if(!n&&!s&&l.every(a=>a.nodeType===Node.TEXT_NODE))return this._insertText(e);l.forEach(a=>{a.nodeType===Node.ELEMENT_NODE?a.nodeName===Q?this._insertEl(u(i,{},"<br/>")):this._insertEl(a):a.textContent&&this._insertEl(u(i,{},a.textContent))})}this._verifyChild(),this._dispatchChange()}_insertEl(e){const n=this.getCursorElement();x(n)?y(e.outerHTML)?this.$editor.insertBefore(e,n):n===this.$editor.children[this.$editor.children.length-1]?this.$editor.insertBefore(u(this.options.childNodeName,{},e),n):(n.innerHTML="",n.append(e)):(y(e.outerHTML)||(e=u(this.options.childNodeName,{},e)),n.nextElementSibling?this.$editor.insertBefore(e,n.nextElementSibling):this.$editor.append(e)),this.setCursorElement(e)}_insertText(e){if(!e)return;const n=window.getSelection(),i=n==null?void 0:n.rangeCount;if(!i)return this.insert(e,!0);n.deleteFromDocument(),n.getRangeAt(0).insertNode(G(e)),this.setCursorElement(n.getRangeAt(i-1).endContainer),n.collapseToEnd()}_verifyChild(){const e=this.getCursorElement(!0),n=this.options.childNodeName;let i,s,o=!1;const l=this.$editor.childNodes;for(let a=0;a<l.length;a++){if(i=l[a],o=i===e,i.nodeType===Node.ELEMENT_NODE&&y(i)){if(this.allowedNodeNames.includes(i.nodeName))continue;s=D(i,n)}else s=u(n,{},i.cloneNode(!0)),this.$editor.replaceChild(s,i);o&&s&&this.setCursorElement(s),s=null}x(this.$editor.lastElementChild)||this.$editor.append(u(n,{},"<br>"))}changeNodeName(e){if(e=(e||this.options.childNodeName).toUpperCase(),!this.allowedNodeNames.includes(e))return!1;const n=this.getCursorElement(),i=D(n,e);return i?(this.setCursorElement(i),this._dispatchChange(),!0):!1}changeStyles(e,n){const i=this.getCursorElement(!0);if(i){const s=w(i);if(e){const o=typeof e=="string"?{[e]:n}:e;i.setAttribute("style",_(s,o))}else{if(!Object.keys(s).length)return;i.removeAttribute("style")}this._dispatchChange()}}_dispatchChange(){this.$editor.dispatchEvent(new InputEvent("input"))}getStyles(){return w(this.getCursorElement())}setCursorElement(e){if(e instanceof Node)for(;e;){if(e.nodeType===Node.ELEMENT_NODE){this._cursorElement=e;break}e=e.parentElement}else e&&(this._cursorElement=e)}getCursorElement(e=!1){return ee(this._cursorElement,this.$editor,e)}destroy(){this.$editor.removeEventListener("focus",this._eventHandler),this.$editor.removeEventListener("blur",this._eventHandler),this.$editor.removeEventListener("input",this._eventHandler),this.$editor.removeEventListener("paste",this._pasteHandler),this.removeAllListeners()}}d.ALLOWED_NODE_NAMES=C,d.Editor=ne,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
