/*!
 * @sp-editor/editor version 1.0.0
 * Author: Capricorncd
 * Released under the MIT License
 * Repository: https://github.com/capricorncd/zx-editor
 * Copyright © 2018-present, Capricorncd/ Xing Zhong.
 */
(function(l,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(l=typeof globalThis<"u"?globalThis:l||self,a(l.Editor={}))})(this,function(l){"use strict";var re=Object.defineProperty;var ie=(l,a,p)=>a in l?re(l,a,{enumerable:!0,configurable:!0,writable:!0,value:p}):l[a]=p;var m=(l,a,p)=>(ie(l,typeof a!="symbol"?a+"":a,p),p);class a{constructor(){this._events={}}on(n,t){return!n||!t||typeof t!="function"?this:(this._events[n]||(this._events[n]=[]),this._events[n].push(t),this)}once(n,t){const r=(...s)=>{t.apply(this,s),this.off(n,r)};return this.on(n,r)}emit(n,...t){const r=this._events[n];if(!r)return this;for(let s=0;s<r.length;s++)try{r[s].apply(this,t)}catch(i){this.emit("error",i,"emit")}return this}off(n,t){if(!this._events[n])return this;const r=this._events[n];if(typeof t=="function"){const s=r.findIndex(i=>i===t);s>=0&&r.splice(s,1)}else this._events[n].length=0;return this._removeEmpty(n),this}_removeEmpty(n){this._events[n].length||delete this._events[n]}removeAllListeners(){Object.keys(this._events).forEach(n=>this.off(n))}}/*!
 * zx-sml version 0.7.5
 * Author: Capricorncd <capricorncd@qq.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2023-05-17 20:41:58 (GMT+0900)
 */var p=Object.defineProperty,y=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable,L=(e,n,t)=>n in e?p(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,T=(e,n)=>{for(var t in n||(n={}))R.call(n,t)&&L(e,t,n[t]);if(y)for(var t of y(n))V.call(n,t)&&L(e,t,n[t]);return e};function F(e){return Array.isArray(e)}function H(e){return typeof e=="object"&&e!==null&&!F(e)}function $(e="",n="-"){return e.replace(/[A-Z]/g,(t,r)=>`${r>0?n:""}${t.toLowerCase()}`)}function O(e="",n=!1){const t=e.replace(/[-_\s](\w)/g,(r,s)=>s.toUpperCase());return n?t.replace(/^\w/,r=>r.toUpperCase()):t}function _(e,n=0){return Array.prototype.slice.call(e,n)}function b(e={},n=!1){const t=n?O:$,r={};for(const[s,i]of Object.entries(e))r[t(s)]=H(i)?b(i,n):i;return r}function K(e,n=document){return e?e instanceof HTMLElement?e:n.querySelector(e):null}function u(e,n={},t){const r=document.createElement(e);for(const[s,i]of Object.entries(n))r.setAttribute($(s),s==="style"&&H(i)?N(i):String(i));return t&&(Array.isArray(t)||(t=[t]),t.forEach(s=>{if(typeof s=="string"){const i=u("div");i.innerHTML=s,r.append(...i.childNodes)}else r.append(s)})),r}function N(...e){const n=e.reduce((r,s)=>T(T({},r),b(s)),{}),t=[];for(const[r,s]of Object.entries(n))s===""||typeof s>"u"||s===null||t.push(`${r}:${s}`);return t.join(";")}const S=(e,n="style")=>e?(e.getAttribute(n)||"").split(/\s?;\s?/).reduce((r,s)=>{const[i,o]=s.split(/\s?:\s?/);return i&&(r[O(i)]=o),r},{}):{},W=e=>document.createTextNode(e),q="sp-editor__editor",w="SECTION",G="BR",v=[w,"H1","H2","H3","H4","H5","BLOCKQUOTE","UL","OL"];function g(e,n,t){return e.replace(RegExp("(^<"+n+")|("+n+">$)","gi"),r=>r.toUpperCase().replace(n,t.toLowerCase()))}function J(e){return e.replace(/<li[^>]*>(.+)<\/li>/gi,"$1")}function C(e){const n=typeof e=="string"?e:e.nodeName;return/^UL|OL$/i.test(n)}function Q(e){if(!e)return!1;const n=_(e.childNodes);return n.length===1&&n[0].nodeName==="BR"}function x(e){return e instanceof Element&&(e=e.outerHTML),/^<(\w+)[^>]*>.*<\/\1>$/.test(e)}function X(e){return["PICTURE","VIDEO","AUDIO","CANVAS"].includes(e.nodeName)}function Z(e){return["IMG"].includes(e.nodeName)||X(e)}function A(e){if(Z(e))return!0;for(let n=0;n<e.children.length;n++)if(A(e.children[n]))return!0;return!1}const z=(e,n)=>{const t={minHeight:e.minHeight,"--placeholder":JSON.stringify(e.placeholder),"--placeholder-color":e.placeholderColor,"--line-height":e.lineHeight,"--paragraph-spacing":e.paragraphTailSpacing,"--padding-bottom":`calc(${e.paddingBottom||"0px"} + env(safe-area-inset-bottom))`,...e.styles};e.caretColor&&(t.caretColor=e.caretColor),e.textColor&&(t.color=e.textColor);const r={class:`${q} is-empty`,style:N(t)};return e.editable&&(r.contenteditable="true"),u("div",r,n)},Y=(e,n)=>{var c,d,D,P,B,I,k,U,j;if(!e)return null;const t=e.nodeName,r=n.toUpperCase();if(t===r)return null;const s=u(n),i=e.parentElement;let o;if(t==="LI"&&C(i)){if(s.innerHTML=g(e.outerHTML,t,r),o=s.firstChild,i.childElementCount>1)if(i.firstElementChild===e)(c=i.parentElement)==null||c.insertBefore(o,i);else if(i.lastElementChild===e){const h=(d=i.parentElement)==null?void 0:d.nextElementSibling;h?(D=h.parentElement)==null||D.insertBefore(o,h):(P=i.parentElement)==null||P.append(o)}else{const h=_(i.children),f=u(i.nodeName);let E=h.shift();for(;E&&E!==e;)f.append(E),E=h.shift();(B=i.parentElement)==null||B.insertBefore(f,i),(I=i.parentElement)==null||I.insertBefore(o,i),i.removeChild(e)}else(k=i.parentElement)==null||k.insertBefore(o,i),(U=i.parentElement)==null||U.removeChild(i);return o}if(/UL|OL/.test(r)){const h=e.previousElementSibling,f=e.nextElementSibling;if(h&&C(h)){if(s.innerHTML=g(e.outerHTML,t,"li"),o=s.firstChild,h.append(o),i==null||i.removeChild(e),f&&f.nodeName===h.nodeName){const E=_(f.children);h.append(...E),(j=f.parentElement)==null||j.removeChild(f)}}else f&&C(f)?(s.innerHTML=g(e.outerHTML,t,"li"),o=s.firstChild,f.insertBefore(o,f.firstElementChild),i==null||i.removeChild(e)):(o=s,s.innerHTML=g(e.outerHTML,t,"li"),i==null||i.replaceChild(o,e))}else s.innerHTML=J(g(e.outerHTML,t,r)),o=s.firstChild,i==null||i.replaceChild(o,e);return o},M=e=>{var n;!((n=e.innerText)!=null&&n.trim())&&!A(e)?e.classList.add("is-empty"):e.classList.remove("is-empty")};function ee(e,n,t=!1){var r;for(;e&&n!==e;){if(!t&&e.nodeName==="LI"&&((r=e.parentElement)==null?void 0:r.parentElement)===n||e.parentElement===n)return e;e=e.parentElement}return n.lastElementChild}const te={editable:!0,minHeight:"50vh",paddingBottom:"50vh",placeholder:"请在此输入内容..",placeholderColor:"#999",lineHeight:1.5,childNodeName:w,allowedNodeNames:v,paragraphTailSpacing:"10px",caretColor:"",textColor:"#333333",customPasteHandler:void 0,insertTextToNewParagraph:!1},se="";class ne extends a{constructor(t){super();m(this,"version");m(this,"options");m(this,"$editor");m(this,"_cursorElement",null);m(this,"_eventHandler");m(this,"allowedNodeNames");m(this,"blankLine");m(this,"_pasteHandler");const r=typeof t.container=="string"?K(t.container):t.container;if(!r)throw new Error(`Can't found '${t.container}' Node in document!`);this.version="1.0.0",this.options={...te,...t},this.allowedNodeNames=(this.options.allowedNodeNames||v).map(i=>i.toUpperCase());const s=this.options.childNodeName.toUpperCase();this.options.childNodeName=s,this.blankLine=`<${s}><br></${s}>`,this.allowedNodeNames.includes(s)||this.allowedNodeNames.push(s),this.$editor=z(this.options,this.blankLine),r.append(this.$editor),this._eventHandler=i=>{const o=i.type;if(o==="blur"||o==="click"){const c=window.getSelection(),d=c&&c.rangeCount?c.getRangeAt(c.rangeCount-1).endContainer:i.currentTarget;this.setCursorElement(d)}this.emit(o==="input"?"change":o,i),M(this.$editor)},this._pasteHandler=i=>{var c;if(typeof this.options.customPasteHandler=="function")return this.options.customPasteHandler(i);i.preventDefault();const o=(c=i.clipboardData)==null?void 0:c.getData("text");this._insertText(o)},this._initEvents()}_initEvents(){this.$editor.addEventListener("focus",this._eventHandler),this.$editor.addEventListener("blur",this._eventHandler),this.$editor.addEventListener("input",this._eventHandler),this.$editor.addEventListener("click",this._eventHandler),this.$editor.addEventListener("paste",this._pasteHandler)}use(t,r){typeof t.install=="function"&&t.install(this,r)}setHtml(t){this.$editor.innerHTML=this.blankLine,this.insert(t,!0),M(this.$editor)}getHtml(t){const r=this.$editor.innerHTML;if(t)return r;const s=this.options.childNodeName;return r.replace(new RegExp(`(<${s}><br\\s?\\/?><\\/${s}>)+$`,"i"),"")}insert(t,r=!1){const{childNodeName:s,insertTextToNewParagraph:i}=this.options;if(t instanceof HTMLElement)this._insertEl(t);else{const o=u("div",{},t),c=_(o.childNodes);if(!r&&!i&&c.every(d=>d.nodeType===Node.TEXT_NODE))return this._insertText(t);c.forEach(d=>{d.nodeType===Node.ELEMENT_NODE?d.nodeName===G?this._insertEl(u(s,{},"<br/>")):this._insertEl(d):d.textContent&&this._insertEl(u(s,{},d.textContent))})}this._dispatchChange()}_insertEl(t){const r=this.getCursorElement();Q(r)?x(t.outerHTML)?this.$editor.insertBefore(t,r):r===this.$editor.children[this.$editor.children.length-1]?this.$editor.insertBefore(u(this.options.childNodeName,{},t),r):(r.innerHTML="",r.append(t)):(x(t.outerHTML)||(t=u(this.options.childNodeName,{},t)),r.nextElementSibling?this.$editor.insertBefore(t,r.nextElementSibling):this.$editor.append(t)),this.setCursorElement(t)}_insertText(t){if(!t)return;const r=window.getSelection(),s=r==null?void 0:r.rangeCount;if(!s)return this.insert(t,!0);r.deleteFromDocument(),r.getRangeAt(0).insertNode(W(t)),this.setCursorElement(r.getRangeAt(s-1).endContainer),r.collapseToEnd(),this._dispatchChange()}changeNodeName(t){if(t=(t||this.options.childNodeName).toUpperCase(),!this.allowedNodeNames.includes(t))return!1;const r=this.getCursorElement(),s=Y(r,t);return s?(this.setCursorElement(s),this._dispatchChange(),!0):!1}changeStyles(t,r){const s=this.getCursorElement(!0);if(s){const i=S(s);if(t){const o=typeof t=="string"?{[t]:r}:t;s.setAttribute("style",N(i,o))}else{if(!Object.keys(i).length)return;s.removeAttribute("style")}this._dispatchChange()}}_dispatchChange(){this.$editor.dispatchEvent(new InputEvent("input"))}getStyles(){return S(this.getCursorElement())}setCursorElement(t){if(t instanceof Node)for(;t;){if(t.nodeType===Node.ELEMENT_NODE){this._cursorElement=t;break}t=t.parentElement}else t&&(this._cursorElement=t)}getCursorElement(t=!1){return ee(this._cursorElement,this.$editor,t)}destroy(){this.$editor.removeEventListener("focus",this._eventHandler),this.$editor.removeEventListener("blur",this._eventHandler),this.$editor.removeEventListener("input",this._eventHandler),this.$editor.removeEventListener("paste",this._pasteHandler),this.removeAllListeners()}}l.ALLOWED_NODE_NAMES=v,l.Editor=ne,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
