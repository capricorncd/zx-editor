{"version":3,"file":"zx-editor.js","sources":["zx-editor.esm.js"],"sourcesContent":["/*!\n * zx-editor v3.1.0\n * https://github.com/capricorncd/zx-editor\n * Released under the MIT License\n * Released on: Sun May 08 2022 17:06:00 GMT+0900 (Japan Standard Time)\n * Copyright © 2018-present, capricorncd\n */\n/**\n * Created by Capricorncd.\n * https://github.com/capricorncd\n * Date: 2022/05/05 14:47:02 (GMT+0900)\n */\n/**\n * to snake case\n * helloWorld => hello-world\n * helloWorld => hello_world\n * helloWorld => hello world\n * @param str\n * @param connectSymbol word connect symbol\n */\nconst toSnakeCase = (str, connectSymbol = '-') => {\n    return str.replace(/[A-Z]/g, (s) => `${connectSymbol}${s.toLowerCase()}`);\n};\n/**\n * to camel case\n * hello_world => helloWorld\n * hello-world => helloWorld\n * hello world => helloWorld\n * @param str\n */\n// export const toCamelCase = (str: string): string => {\n//   return str.replace(/[-_\\s](\\w)/g, (_, s) => s.toUpperCase())\n// }\nconst slice = (arrLike, offset = 0) => {\n    return Array.prototype.slice.call(arrLike, offset);\n};\n\n/**\n * Created by Capricorncd.\n * https://github.com/capricorncd\n * Date: 2022/05/05 11:55:07 (GMT+0900)\n */\nconst CLASS_NAME_EDITOR = 'zx-editor';\nconst CLASS_NAME_CONTENT = 'zx-editor-content-wrapper';\n\nconst DEF_OPTIONS = {\n    // 内容是否可以被编辑\n    editable: true,\n    // 编辑器输入内容绝对定位\n    // fixed: false,\n    // editor min height\n    minHeight: '50vh',\n    // style\n    placeholder: 'Enter...',\n    placeholderColor: '',\n    lineHeight: 1.5,\n    // paragraph tail spacing, default 10px\n    // paragraphTailSpacing: '',\n    caretColor: '',\n    textColor: '',\n    // iphone会自动移动，难控制\n    // 光标所在行距页面顶部的距离30px\n    cursorOffsetTop: 30,\n    // 自定义粘贴处理函数\n    customPasteHandler: undefined,\n    /**\n     * ******************************\n     * toolbar options\n     * ******************************\n     */\n    // Has the toolbar been fixed?\n    toolbarBeenFixed: true,\n    toolbarHeight: 50,\n    // buttons name, and order\n    toolbarButtons: ['select-picture', 'text-style'],\n    /**\n     * ******************************\n     * image options\n     * ******************************\n     */\n    // customize Picture Handler\n    // customPictureHandler: undefined,\n    // image max width\n    imageMaxWidth: 720,\n    // image max size, unit Kib, default 20M\n    imageMaxSize: 20480,\n    // template\n    imageSectionTemp: `<section class=\"child-is-picture\"><img src=\"{url}\" loading=\"lazy\"></section>`,\n    // GIF pictures are not processed\n    ignoreGif: true,\n    // Force the width/height of the picture, even if the width/height of the picture\n    // is smaller than the target width/height\n    forceImageResize: false,\n    /**\n     * ******************************\n     * text style options\n     * ******************************\n     */\n    // text style, value ['#333', '#f00', ...]\n    // textStyleColors: undefined,\n    textStyleTitle: 'Set Style',\n    textStyleHeadLeftBtnText: 'Clear style',\n    textStyleHeadAlign: 'center',\n    /**\n     * ******************************\n     * color options\n     * ******************************\n     */\n    mainColor: '',\n    // border color\n    borderColor: '',\n};\n\n/**\n * Created by Capricorncd.\n * https://github.com/capricorncd\n * Date: 2022/05/05 10:32:12 (GMT+0900)\n */\nconst NODE_NAME_SECTION = 'SECTION';\nconst NODE_NAME_BR = 'BR';\n\n/**\n * Created by Capricorncd.\n * https://github.com/capricorncd\n * Date: 2022/05/05 10:55:25 (GMT+0900)\n */\nconst REPLACE_NODE_LIST = [\n    'DIV', 'P', 'ARTICLE', 'ASIDE', 'DETAILS',\n    // 'SUMMARY',\n    'FOOTER', 'HEADER', 'MAIN', 'NAV',\n];\nconst $ = (selector, doc = document) => {\n    if (selector instanceof HTMLElement)\n        return selector;\n    return doc.querySelector(selector);\n};\n// export const $$ = <T extends HTMLElement>(selector: string, doc: Document | HTMLElement = document): T[] => {\n//   return Array.prototype.slice.call(doc.querySelectorAll(selector), 0)\n// }\nconst createElement = (tag, attrs = {}, innerHTML) => {\n    const el = document.createElement(tag);\n    for (const [key, val] of Object.entries(attrs)) {\n        el.setAttribute(key, val);\n    }\n    if (innerHTML)\n        el.innerHTML = innerHTML;\n    return el;\n};\nconst createStyles = (data) => {\n    const arr = [];\n    for (const [key, value] of Object.entries(data)) {\n        arr.push(`${toSnakeCase(key)}:${value}`);\n    }\n    return arr.join(';');\n};\nconst replace = (input, oldNodeName, newNodeName) => {\n    return input.replace(RegExp(\"(^<\" + oldNodeName + \")|(\" + oldNodeName + \">$)\", \"gi\"), (match) => match.toUpperCase().replace(oldNodeName, newNodeName.toLowerCase()));\n};\n/**\n *\n * @param input\n * @param tagName\n */\nconst changeNodeName = (input, tagName = NODE_NAME_SECTION) => {\n    const oldNodeName = input.nodeName;\n    const newNodeName = tagName.toUpperCase();\n    if (oldNodeName === newNodeName)\n        return input;\n    const el = createElement(tagName);\n    const parent = input.parentElement;\n    if (REPLACE_NODE_LIST.includes(oldNodeName)) {\n        el.innerHTML = replace(input.outerHTML, oldNodeName, newNodeName);\n        parent?.replaceChild(el.firstChild, input);\n        return el.firstChild;\n    }\n    el.append(input.cloneNode(true));\n    parent?.replaceChild(el, input);\n    return el;\n};\n/**\n * is <br> section\n * <section><br></section>\n * @param el\n */\nconst isBrSection = (el) => {\n    if (!el)\n        return false;\n    const nodes = slice(el.childNodes);\n    return nodes.length === 1 && nodes[0].nodeName === 'BR';\n};\n\n/**\n * Created by Capricorncd.\n * https://github.com/capricorncd\n * Date: 2022/05/07 10:33:02 (GMT+0900)\n */\nclass CursorClass {\n    rootElement;\n    selection;\n    range;\n    timer;\n    constructor(rootElement) {\n        this.rootElement = rootElement;\n        this.selection = window.getSelection();\n        this.range = this.selection ? this.selection.getRangeAt(0) : new Range();\n        this.timer = null;\n        // init range\n        const el = rootElement.lastElementChild;\n        if (el) {\n            this.setRange(el, el.textContent?.length);\n        }\n    }\n    setRange(el, offset = 0) {\n        // remove all range object\n        if (this.selection)\n            this.selection.removeAllRanges();\n        // el: '<section>inner text.</section>'\n        let targetNode = el.childNodes[el.childNodes.length - 1] || el;\n        // check img/video/audio\n        // console.log(targetNode.nodeName, this.offset)\n        if (/IMG|VIDEO|AUDIO/.test(targetNode.nodeName)) {\n            offset = 1;\n            // get parentNode, can't set offset = 1 of IMG node.\n            targetNode = targetNode.parentNode;\n        }\n        this.range.setStart(targetNode, offset);\n        // cursor start and end position is collapse\n        this.range.collapse(true);\n        this._clearTimeout();\n        // 延时执行，键盘自动收起后再触发focus\n        this.timer = setTimeout(() => {\n            // 插入新的光标对象\n            this.selection?.addRange(this.range);\n        }, 100);\n    }\n    _clearTimeout() {\n        if (this.timer) {\n            clearTimeout(this.timer);\n            this.timer = null;\n        }\n    }\n    getCurrentNode() {\n        this.range = this.selection ? this.selection.getRangeAt(0) : new Range();\n        let currentNode = this.range.endContainer;\n        while (this.rootElement !== currentNode) {\n            if (currentNode.parentElement === this.rootElement) {\n                return currentNode;\n            }\n            else {\n                currentNode = currentNode.parentNode;\n            }\n        }\n        return this.rootElement.lastElementChild;\n    }\n}\n\nclass EventEmitter {\n    eventList;\n    constructor() {\n        this.eventList = {};\n    }\n    /**\n     * on\n     * @param eventName\n     * @param fn\n     */\n    on(eventName, fn) {\n        if (!eventName || !fn || typeof fn !== 'function')\n            return;\n        if (!this.eventList[eventName]) {\n            this.eventList[eventName] = [];\n        }\n        this.eventList[eventName].push(fn);\n    }\n    /**\n     * emit\n     * @param eventName\n     * @param args\n     */\n    emit(eventName, ...args) {\n        const fnList = this.eventList[eventName];\n        if (!fnList)\n            return;\n        for (let i = 0; i < fnList.length; i++) {\n            try {\n                fnList[i].apply(null, args);\n            }\n            catch (e) {\n                this.emit('error', e, 'emit');\n            }\n        }\n    }\n    /**\n     * off\n     * @param eventName\n     * @param fn\n     */\n    off(eventName, fn) {\n        if (!this.eventList[eventName])\n            return;\n        const eventList = this.eventList[eventName];\n        if (typeof fn === 'function') {\n            const index = eventList.findIndex(item => item === fn);\n            if (index >= 0)\n                eventList.splice(index, 1);\n        }\n        else {\n            this.eventList[eventName].length = 0;\n        }\n        this._removeEmpty(eventName);\n    }\n    /**\n     * remove empty event list\n     * @param eventName\n     * @private\n     */\n    _removeEmpty(eventName) {\n        if (!this.eventList[eventName].length) {\n            delete this.eventList[eventName];\n        }\n    }\n    destroyEventEmitter() {\n        Object.keys(this.eventList).forEach((key => this.off(key)));\n    }\n}\n\n/**\n * Created by Capricorncd.\n * https://github.com/capricorncd\n * Date: 2022/05/05 11:07:32 (GMT+0900)\n */\n/**\n * init editor dom\n */\nconst initEditorDom = () => {\n    const el = createElement('div', {\n        class: CLASS_NAME_EDITOR,\n    });\n    return el;\n};\n/**\n * init content dom\n * @param options\n */\nconst initContentDom = (options) => {\n    const contentStyles = {\n        lineHeight: options.lineHeight,\n        minHeight: options.minHeight,\n        position: 'relative',\n        overflowY: 'scroll',\n        outline: 'none',\n        // 用户自定义样式优先\n        ...options.styles,\n    };\n    if (options.caretColor)\n        contentStyles.caretColor = options.caretColor;\n    if (options.textColor)\n        contentStyles.color = options.textColor;\n    const contentAttrs = {\n        class: `${CLASS_NAME_CONTENT} is-empty`,\n        style: createStyles(contentStyles),\n    };\n    if (options.editable)\n        contentAttrs.contenteditable = 'true';\n    const el = createElement('div', contentAttrs);\n    el.innerHTML = `<section><br></section>`;\n    // return\n    return el;\n};\n\n/**\n * Created by Capricorncd.\n * https://github.com/capricorncd\n * Date: 2022/05/05 10:29:43 (GMT+0900)\n */\nclass ZxEditor extends EventEmitter {\n    $wrapper;\n    version;\n    options;\n    $editor;\n    $content;\n    cursor;\n    _contentEvent;\n    constructor(selector, options) {\n        super();\n        if (!(this instanceof ZxEditor)) {\n            throw new Error('ZxEditor is a constructor and should be called with the `new` keyword');\n        }\n        /**\n         * ***************************************************\n         * check selector\n         * ***************************************************\n         */\n        const container = $(selector);\n        if (!container) {\n            throw new Error(`Can't found '${selector}' Node in document!`);\n        }\n        this.$wrapper = container;\n        // version\n        this.version = '3.1.0';\n        console.log(this.version);\n        this.options = {\n            ...DEF_OPTIONS,\n            ...options,\n        };\n        this.$content = initContentDom(this.options);\n        this.$editor = initEditorDom();\n        this.$editor.append(this.$content);\n        this.$wrapper.append(this.$editor);\n        this.$content.focus();\n        this.cursor = new CursorClass(this.$content);\n        this._contentEvent = (e) => {\n            const type = e.type;\n            if (type === 'blur')\n                this._lastLine();\n            this.emit(type === 'input' ? 'change' : type, e);\n        };\n        this._initEvents();\n    }\n    _initEvents() {\n        this.$content.addEventListener('focus', this._contentEvent);\n        this.$content.addEventListener('blur', this._contentEvent);\n        this.$content.addEventListener('input', this._contentEvent);\n    }\n    /**\n     * use\n     * @param plugin\n     */\n    use(plugin) {\n        if (typeof plugin.install === 'function') {\n            plugin.install(this);\n        }\n    }\n    /**\n     * plugin\n     * @param fn\n     */\n    plugin(fn) {\n        if (typeof fn === 'function')\n            fn.call(this);\n    }\n    setHtml(html) {\n        this.$content.innerHTML = '';\n        this.insert(html);\n        this._lastLine();\n    }\n    getHtml() {\n        return this.$content.innerHTML.replace(/<section><br><\\/section>$/, '');\n    }\n    /**\n     * Node.nodeType\n     * ELEMENT_NODE  1\n     * ATTRIBUTE_NODE  2\n     * TEXT_NODE  3\n     * CDATA_SECTION_NODE  4\n     * PROCESSING_INSTRUCTION_NODE  7\n     * COMMENT_NODE  8\n     * DOCUMENT_NODE  9\n     * DOCUMENT_TYPE_NODE  10\n     * DOCUMENT_FRAGMENT_NODE  11\n     * @param input\n     */\n    insert(input) {\n        if (input instanceof HTMLElement) {\n            this._insert(input);\n        }\n        else {\n            const el = createElement('div');\n            el.innerHTML = input;\n            slice(el.childNodes).forEach((node) => {\n                if (node.nodeType === Node.ELEMENT_NODE) {\n                    if (node.nodeName === NODE_NAME_BR) {\n                        this._insert(createElement(NODE_NAME_SECTION, {}, '<br/>'));\n                    }\n                    else {\n                        this._insert(node);\n                    }\n                }\n                else if (node.textContent) {\n                    this._insert(createElement(NODE_NAME_SECTION, {}, node.textContent));\n                }\n            });\n        }\n    }\n    _insert(input) {\n        console.log(input);\n        const currentSection = this.cursor.getCurrentNode();\n        if (currentSection) {\n            if (isBrSection(currentSection)) {\n                this.$content.insertBefore(input, currentSection);\n            }\n            else {\n                this.$content.insertBefore(input, currentSection.nextElementSibling);\n            }\n        }\n        else {\n            this.$content.append(input);\n        }\n        changeNodeName(input, NODE_NAME_SECTION);\n    }\n    _lastLine() {\n        if (!isBrSection(this.$content.lastElementChild)) {\n            this.$content.appendChild(createElement('section', {}, '<br>'));\n        }\n    }\n    destroy() {\n        this.$content.removeEventListener('focus', this._contentEvent);\n        this.$content.removeEventListener('blur', this._contentEvent);\n        this.$content.removeEventListener('input', this._contentEvent);\n        this.destroyEventEmitter();\n    }\n}\n\nexport { ZxEditor };\n//# sourceMappingURL=zx-editor.esm.js.map\n"],"names":["toSnakeCase","str","connectSymbol","replace","s","toLowerCase","slice","arrLike","offset","Array","prototype","call","CLASS_NAME_EDITOR","CLASS_NAME_CONTENT","DEF_OPTIONS","editable","minHeight","placeholder","placeholderColor","lineHeight","caretColor","textColor","cursorOffsetTop","customPasteHandler","undefined","toolbarBeenFixed","toolbarHeight","toolbarButtons","imageMaxWidth","imageMaxSize","imageSectionTemp","ignoreGif","forceImageResize","textStyleTitle","textStyleHeadLeftBtnText","textStyleHeadAlign","mainColor","borderColor","NODE_NAME_SECTION","NODE_NAME_BR","REPLACE_NODE_LIST","$","selector","doc","document","HTMLElement","querySelector","createElement","tag","attrs","innerHTML","el","Object","entries","key","val","setAttribute","createStyles","data","arr","value","push","join","input","oldNodeName","newNodeName","RegExp","match","toUpperCase","changeNodeName","tagName","nodeName","parent","parentElement","includes","outerHTML","replaceChild","firstChild","append","cloneNode","isBrSection","nodes","childNodes","length","CursorClass","rootElement","selection","window","getSelection","range","getRangeAt","Range","timer","lastElementChild","setRange","textContent","removeAllRanges","targetNode","test","parentNode","setStart","collapse","_clearTimeout","setTimeout","addRange","clearTimeout","currentNode","endContainer","EventEmitter","eventList","eventName","fn","fnList","args","i","apply","e","emit","index","findIndex","item","splice","_removeEmpty","keys","forEach","off","initEditorDom","initContentDom","options","contentStyles","position","overflowY","outline","styles","color","contentAttrs","style","contenteditable","ZxEditor","Error","container","$wrapper","version","console","log","$content","$editor","focus","cursor","_contentEvent","type","_lastLine","_initEvents","addEventListener","plugin","install","html","insert","_insert","node","nodeType","Node","ELEMENT_NODE","currentSection","getCurrentNode","insertBefore","nextElementSibling","appendChild","removeEventListener","destroyEventEmitter"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA;AACA;AACA;AACA;AACA;AACA;AACA;;EACA;AACA;AACA;AACA;AACA;;EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACA,IAAMA,WAAW,GAAG,SAAdA,WAAc,CAACC,GAAD,EAA8B;IAAA,IAAxBC,aAAwB,uEAAR,GAAQ;IAC9C,OAAOD,GAAG,CAACE,OAAJ,CAAY,QAAZ,EAAsB,UAACC,CAAD;MAAA,iBAAUF,aAAV,SAA0BE,CAAC,CAACC,WAAF,EAA1B;IAAA,CAAtB,CAAP;EACH,CAFD;EAGA;AACA;AACA;AACA;AACA;AACA;AACA;EACA;EACA;EACA;;;EACA,IAAMC,KAAK,GAAG,SAARA,KAAQ,CAACC,OAAD,EAAyB;IAAA,IAAfC,MAAe,uEAAN,CAAM;IACnC,OAAOC,KAAK,CAACC,SAAN,CAAgBJ,KAAhB,CAAsBK,IAAtB,CAA2BJ,OAA3B,EAAoCC,MAApC,CAAP;EACH,CAFD;EAIA;AACA;AACA;AACA;AACA;;;EACA,IAAMI,iBAAiB,GAAG,WAA1B;EACA,IAAMC,kBAAkB,GAAG,2BAA3B;EAEA,IAAMC,WAAW,GAAG;IACpB;IACIC,QAAQ,EAAE,IAFM;IAGpB;IACA;IACA;IACIC,SAAS,EAAE,MANK;IAOpB;IACIC,WAAW,EAAE,UARG;IAShBC,gBAAgB,EAAE,EATF;IAUhBC,UAAU,EAAE,GAVI;IAWpB;IACA;IACIC,UAAU,EAAE,EAbI;IAchBC,SAAS,EAAE,EAdK;IAepB;IACA;IACIC,eAAe,EAAE,EAjBD;IAkBpB;IACIC,kBAAkB,EAAEC,SAnBJ;;IAoBpB;AACA;AACA;AACA;AACA;IACA;IACIC,gBAAgB,EAAE,IA1BF;IA2BhBC,aAAa,EAAE,EA3BC;IA4BpB;IACIC,cAAc,EAAE,CAAC,gBAAD,EAAmB,YAAnB,CA7BA;;IA8BpB;AACA;AACA;AACA;AACA;IACA;IACA;IACA;IACIC,aAAa,EAAE,GAtCC;IAuCpB;IACIC,YAAY,EAAE,KAxCE;IAyCpB;IACIC,gBAAgB,sFA1CA;IA2CpB;IACIC,SAAS,EAAE,IA5CK;IA6CpB;IACA;IACIC,gBAAgB,EAAE,KA/CF;;IAgDpB;AACA;AACA;AACA;AACA;IACA;IACA;IACIC,cAAc,EAAE,WAvDA;IAwDhBC,wBAAwB,EAAE,aAxDV;IAyDhBC,kBAAkB,EAAE,QAzDJ;;IA0DpB;AACA;AACA;AACA;AACA;IACIC,SAAS,EAAE,EA/DK;IAgEpB;IACIC,WAAW,EAAE;EAjEG,CAApB;EAoEA;AACA;AACA;AACA;AACA;;EACA,IAAMC,iBAAiB,GAAG,SAA1B;EACA,IAAMC,YAAY,GAAG,IAArB;EAEA;AACA;AACA;AACA;AACA;;EACA,IAAMC,iBAAiB,GAAG,CACtB,KADsB,EACf,GADe,EACV,SADU,EACC,OADD,EACU,SADV,EAE1B;EACI,QAHsB,EAGZ,QAHY,EAGF,MAHE,EAGM,KAHN,CAA1B;;EAKA,IAAMC,CAAC,GAAG,SAAJA,CAAI,CAACC,QAAD,EAA8B;IAAA,IAAnBC,GAAmB,uEAAbC,QAAa;IACpC,IAAIF,QAAQ,YAAYG,WAAxB,EACI,OAAOH,QAAP;IACJ,OAAOC,GAAG,CAACG,aAAJ,CAAkBJ,QAAlB,CAAP;EACH,CAJD,EAKA;EACA;EACA;;;EACA,IAAMK,aAAa,GAAG,SAAhBA,aAAgB,CAACC,GAAD,EAAgC;IAAA,IAA1BC,KAA0B,uEAAlB,EAAkB;IAAA,IAAdC,SAAc;IAClD,IAAMC,EAAE,GAAGP,QAAQ,CAACG,aAAT,CAAuBC,GAAvB,CAAX;;IACA,mCAAyBI,MAAM,CAACC,OAAP,CAAeJ,KAAf,CAAzB,qCAAgD;MAA3C;MAAA,IAAOK,GAAP;MAAA,IAAYC,GAAZ;;MACDJ,EAAE,CAACK,YAAH,CAAgBF,GAAhB,EAAqBC,GAArB;IACH;;IACD,IAAIL,SAAJ,EACIC,EAAE,CAACD,SAAH,GAAeA,SAAf;IACJ,OAAOC,EAAP;EACH,CARD;;EASA,IAAMM,YAAY,GAAG,SAAfA,YAAe,CAACC,IAAD,EAAU;IAC3B,IAAMC,GAAG,GAAG,EAAZ;;IACA,qCAA2BP,MAAM,CAACC,OAAP,CAAeK,IAAf,CAA3B,wCAAiD;MAA5C;MAAA,IAAOJ,GAAP;MAAA,IAAYM,KAAZ;;MACDD,GAAG,CAACE,IAAJ,WAAY7D,WAAW,CAACsD,GAAD,CAAvB,cAAgCM,KAAhC;IACH;;IACD,OAAOD,GAAG,CAACG,IAAJ,CAAS,GAAT,CAAP;EACH,CAND;;EAOA,IAAM3D,OAAO,GAAG,SAAVA,OAAU,CAAC4D,KAAD,EAAQC,WAAR,EAAqBC,WAArB,EAAqC;IACjD,OAAOF,KAAK,CAAC5D,OAAN,CAAc+D,MAAM,CAAC,QAAQF,WAAR,GAAsB,KAAtB,GAA8BA,WAA9B,GAA4C,KAA7C,EAAoD,IAApD,CAApB,EAA+E,UAACG,KAAD;MAAA,OAAWA,KAAK,CAACC,WAAN,GAAoBjE,OAApB,CAA4B6D,WAA5B,EAAyCC,WAAW,CAAC5D,WAAZ,EAAzC,CAAX;IAAA,CAA/E,CAAP;EACH,CAFD;EAGA;AACA;AACA;AACA;AACA;;;EACA,IAAMgE,cAAc,GAAG,SAAjBA,cAAiB,CAACN,KAAD,EAAwC;IAAA,IAAhCO,OAAgC,uEAAtBhC,iBAAsB;IAC3D,IAAM0B,WAAW,GAAGD,KAAK,CAACQ,QAA1B;IACA,IAAMN,WAAW,GAAGK,OAAO,CAACF,WAAR,EAApB;IACA,IAAIJ,WAAW,KAAKC,WAApB,EACI,OAAOF,KAAP;IACJ,IAAMZ,EAAE,GAAGJ,aAAa,CAACuB,OAAD,CAAxB;IACA,IAAME,MAAM,GAAGT,KAAK,CAACU,aAArB;;IACA,IAAIjC,iBAAiB,CAACkC,QAAlB,CAA2BV,WAA3B,CAAJ,EAA6C;MACzCb,EAAE,CAACD,SAAH,GAAe/C,OAAO,CAAC4D,KAAK,CAACY,SAAP,EAAkBX,WAAlB,EAA+BC,WAA/B,CAAtB;MACAO,MAAM,SAAN,IAAAA,MAAM,WAAN,YAAAA,MAAM,CAAEI,YAAR,CAAqBzB,EAAE,CAAC0B,UAAxB,EAAoCd,KAApC;MACA,OAAOZ,EAAE,CAAC0B,UAAV;IACH;;IACD1B,EAAE,CAAC2B,MAAH,CAAUf,KAAK,CAACgB,SAAN,CAAgB,IAAhB,CAAV;IACAP,MAAM,SAAN,IAAAA,MAAM,WAAN,YAAAA,MAAM,CAAEI,YAAR,CAAqBzB,EAArB,EAAyBY,KAAzB;IACA,OAAOZ,EAAP;EACH,CAfD;EAgBA;AACA;AACA;AACA;AACA;;;EACA,IAAM6B,WAAW,GAAG,SAAdA,WAAc,CAAC7B,EAAD,EAAQ;IACxB,IAAI,CAACA,EAAL,EACI,OAAO,KAAP;IACJ,IAAM8B,KAAK,GAAG3E,KAAK,CAAC6C,EAAE,CAAC+B,UAAJ,CAAnB;IACA,OAAOD,KAAK,CAACE,MAAN,KAAiB,CAAjB,IAAsBF,KAAK,CAAC,CAAD,CAAL,CAASV,QAAT,KAAsB,IAAnD;EACH,CALD;EAOA;AACA;AACA;AACA;AACA;;;MACMa;IAKF,qBAAYC,WAAZ,EAAyB;MAAA;;MAAA;;MAAA;;MAAA;;MAAA;;MACrB,KAAKA,WAAL,GAAmBA,WAAnB;MACA,KAAKC,SAAL,GAAiBC,MAAM,CAACC,YAAP,EAAjB;MACA,KAAKC,KAAL,GAAa,KAAKH,SAAL,GAAiB,KAAKA,SAAL,CAAeI,UAAf,CAA0B,CAA1B,CAAjB,GAAgD,IAAIC,KAAJ,EAA7D;MACA,KAAKC,KAAL,GAAa,IAAb,CAJqB,CAK7B;;MACQ,IAAMzC,EAAE,GAAGkC,WAAW,CAACQ,gBAAvB;;MACA,IAAI1C,EAAJ,EAAQ;QAAA;;QACJ,KAAK2C,QAAL,CAAc3C,EAAd,qBAAkBA,EAAE,CAAC4C,WAArB,oDAAkB,gBAAgBZ,MAAlC;MACH;IACJ;;;;aACD,kBAAShC,EAAT,EAAyB;QAAA;;QAAA,IAAZ3C,MAAY,uEAAH,CAAG;QAC7B;QACQ,IAAI,KAAK8E,SAAT,EACI,KAAKA,SAAL,CAAeU,eAAf,GAHiB,CAI7B;;QACQ,IAAIC,UAAU,GAAG9C,EAAE,CAAC+B,UAAH,CAAc/B,EAAE,CAAC+B,UAAH,CAAcC,MAAd,GAAuB,CAArC,KAA2ChC,EAA5D,CALqB,CAM7B;QACA;;QACQ,IAAI,kBAAkB+C,IAAlB,CAAuBD,UAAU,CAAC1B,QAAlC,CAAJ,EAAiD;UAC7C/D,MAAM,GAAG,CAAT,CAD6C,CAEzD;;UACYyF,UAAU,GAAGA,UAAU,CAACE,UAAxB;QACH;;QACD,KAAKV,KAAL,CAAWW,QAAX,CAAoBH,UAApB,EAAgCzF,MAAhC,EAbqB,CAc7B;;QACQ,KAAKiF,KAAL,CAAWY,QAAX,CAAoB,IAApB;;QACA,KAAKC,aAAL,GAhBqB,CAiB7B;;;QACQ,KAAKV,KAAL,GAAaW,UAAU,CAAC,YAAM;UAAA;;UACtC;UACY,mBAAA,KAAI,CAACjB,SAAL,oEAAgBkB,QAAhB,CAAyB,KAAI,CAACf,KAA9B;QACH,CAHsB,EAGpB,GAHoB,CAAvB;MAIH;;;aACD,yBAAgB;QACZ,IAAI,KAAKG,KAAT,EAAgB;UACZa,YAAY,CAAC,KAAKb,KAAN,CAAZ;UACA,KAAKA,KAAL,GAAa,IAAb;QACH;MACJ;;;aACD,0BAAiB;QACb,KAAKH,KAAL,GAAa,KAAKH,SAAL,GAAiB,KAAKA,SAAL,CAAeI,UAAf,CAA0B,CAA1B,CAAjB,GAAgD,IAAIC,KAAJ,EAA7D;QACA,IAAIe,WAAW,GAAG,KAAKjB,KAAL,CAAWkB,YAA7B;;QACA,OAAO,KAAKtB,WAAL,KAAqBqB,WAA5B,EAAyC;UACrC,IAAIA,WAAW,CAACjC,aAAZ,KAA8B,KAAKY,WAAvC,EAAoD;YAChD,OAAOqB,WAAP;UACH,CAFD,MAGK;YACDA,WAAW,GAAGA,WAAW,CAACP,UAA1B;UACH;QACJ;;QACD,OAAO,KAAKd,WAAL,CAAiBQ,gBAAxB;MACH;;;;;;MAGCe;IAEF,wBAAc;MAAA;;MAAA;;MACV,KAAKC,SAAL,GAAiB,EAAjB;IACH;IACL;AACA;AACA;AACA;AACA;;;;;aACI,YAAGC,SAAH,EAAcC,EAAd,EAAkB;QACd,IAAI,CAACD,SAAD,IAAc,CAACC,EAAf,IAAqB,OAAOA,EAAP,KAAc,UAAvC,EACI;;QACJ,IAAI,CAAC,KAAKF,SAAL,CAAeC,SAAf,CAAL,EAAgC;UAC5B,KAAKD,SAAL,CAAeC,SAAf,IAA4B,EAA5B;QACH;;QACD,KAAKD,SAAL,CAAeC,SAAf,EAA0BjD,IAA1B,CAA+BkD,EAA/B;MACH;MACL;AACA;AACA;AACA;AACA;;;;aACI,cAAKD,SAAL,EAAyB;QACrB,IAAME,MAAM,GAAG,KAAKH,SAAL,CAAeC,SAAf,CAAf;QACA,IAAI,CAACE,MAAL,EACI;;QAHiB,kCAANC,IAAM;UAANA,IAAM;QAAA;;QAIrB,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,MAAM,CAAC7B,MAA3B,EAAmC+B,CAAC,EAApC,EAAwC;UACpC,IAAI;YACAF,MAAM,CAACE,CAAD,CAAN,CAAUC,KAAV,CAAgB,IAAhB,EAAsBF,IAAtB;UACH,CAFD,CAGA,OAAOG,CAAP,EAAU;YACN,KAAKC,IAAL,CAAU,OAAV,EAAmBD,CAAnB,EAAsB,MAAtB;UACH;QACJ;MACJ;MACL;AACA;AACA;AACA;AACA;;;;aACI,aAAIN,SAAJ,EAAeC,EAAf,EAAmB;QACf,IAAI,CAAC,KAAKF,SAAL,CAAeC,SAAf,CAAL,EACI;QACJ,IAAMD,SAAS,GAAG,KAAKA,SAAL,CAAeC,SAAf,CAAlB;;QACA,IAAI,OAAOC,EAAP,KAAc,UAAlB,EAA8B;UAC1B,IAAMO,KAAK,GAAGT,SAAS,CAACU,SAAV,CAAoB,UAAAC,IAAI;YAAA,OAAIA,IAAI,KAAKT,EAAb;UAAA,CAAxB,CAAd;UACA,IAAIO,KAAK,IAAI,CAAb,EACIT,SAAS,CAACY,MAAV,CAAiBH,KAAjB,EAAwB,CAAxB;QACP,CAJD,MAKK;UACD,KAAKT,SAAL,CAAeC,SAAf,EAA0B3B,MAA1B,GAAmC,CAAnC;QACH;;QACD,KAAKuC,YAAL,CAAkBZ,SAAlB;MACH;MACL;AACA;AACA;AACA;AACA;;;;aACI,sBAAaA,SAAb,EAAwB;QACpB,IAAI,CAAC,KAAKD,SAAL,CAAeC,SAAf,EAA0B3B,MAA/B,EAAuC;UACnC,OAAO,KAAK0B,SAAL,CAAeC,SAAf,CAAP;QACH;MACJ;;;aACD,+BAAsB;QAAA;;QAClB1D,MAAM,CAACuE,IAAP,CAAY,KAAKd,SAAjB,EAA4Be,OAA5B,CAAqC,UAAAtE,GAAG;UAAA,OAAI,MAAI,CAACuE,GAAL,CAASvE,GAAT,CAAJ;QAAA,CAAxC;MACH;;;;;EAGL;AACA;AACA;AACA;AACA;;EACA;AACA;AACA;;;EACA,IAAMwE,aAAa,GAAG,SAAhBA,aAAgB,GAAM;IACxB,IAAM3E,EAAE,GAAGJ,aAAa,CAAC,KAAD,EAAQ;MAC5B,SAAOnC;IADqB,CAAR,CAAxB;IAGA,OAAOuC,EAAP;EACH,CALD;EAMA;AACA;AACA;AACA;;;EACA,IAAM4E,cAAc,GAAG,SAAjBA,cAAiB,CAACC,OAAD,EAAa;IAChC,IAAMC,aAAa;MACf9G,UAAU,EAAE6G,OAAO,CAAC7G,UADL;MAEfH,SAAS,EAAEgH,OAAO,CAAChH,SAFJ;MAGfkH,QAAQ,EAAE,UAHK;MAIfC,SAAS,EAAE,QAJI;MAKfC,OAAO,EAAE;IALM,GAOZJ,OAAO,CAACK,MAPI,CAAnB;;IASA,IAAIL,OAAO,CAAC5G,UAAZ,EACI6G,aAAa,CAAC7G,UAAd,GAA2B4G,OAAO,CAAC5G,UAAnC;IACJ,IAAI4G,OAAO,CAAC3G,SAAZ,EACI4G,aAAa,CAACK,KAAd,GAAsBN,OAAO,CAAC3G,SAA9B;IACJ,IAAMkH,YAAY,GAAG;MACjB,mBAAU1H,kBAAV,cADiB;MAEjB2H,KAAK,EAAE/E,YAAY,CAACwE,aAAD;IAFF,CAArB;IAIA,IAAID,OAAO,CAACjH,QAAZ,EACIwH,YAAY,CAACE,eAAb,GAA+B,MAA/B;IACJ,IAAMtF,EAAE,GAAGJ,aAAa,CAAC,KAAD,EAAQwF,YAAR,CAAxB;IACApF,EAAE,CAACD,SAAH,6BArBgC,CAsBpC;;IACI,OAAOC,EAAP;EACH,CAxBD;EA0BA;AACA;AACA;AACA;AACA;;;MACMuF;;;;;IAQF,kBAAYhG,QAAZ,EAAsBsF,OAAtB,EAA+B;MAAA;;MAAA;;MAC3B;;MAD2B;;MAAA;;MAAA;;MAAA;;MAAA;;MAAA;;MAAA;;MAE3B,IAAI,EAAE,0CAAgBU,QAAlB,CAAJ,EAAiC;QAC7B,MAAM,IAAIC,KAAJ,CAAU,uEAAV,CAAN;MACH;MACT;AACA;AACA;AACA;AACA;;;MACQ,IAAMC,SAAS,GAAGnG,CAAC,CAACC,QAAD,CAAnB;;MACA,IAAI,CAACkG,SAAL,EAAgB;QACZ,MAAM,IAAID,KAAJ,wBAA0BjG,QAA1B,yBAAN;MACH;;MACD,OAAKmG,QAAL,GAAgBD,SAAhB,CAd2B,CAenC;;MACQ,OAAKE,OAAL,GAAe,OAAf;MACAC,OAAO,CAACC,GAAR,CAAY,OAAKF,OAAjB;MACA,OAAKd,OAAL,mCACOlH,WADP,GAEOkH,OAFP;MAIA,OAAKiB,QAAL,GAAgBlB,cAAc,CAAC,OAAKC,OAAN,CAA9B;MACA,OAAKkB,OAAL,GAAepB,aAAa,EAA5B;;MACA,OAAKoB,OAAL,CAAapE,MAAb,CAAoB,OAAKmE,QAAzB;;MACA,OAAKJ,QAAL,CAAc/D,MAAd,CAAqB,OAAKoE,OAA1B;;MACA,OAAKD,QAAL,CAAcE,KAAd;;MACA,OAAKC,MAAL,GAAc,IAAIhE,WAAJ,CAAgB,OAAK6D,QAArB,CAAd;;MACA,OAAKI,aAAL,GAAqB,UAACjC,CAAD,EAAO;QACxB,IAAMkC,IAAI,GAAGlC,CAAC,CAACkC,IAAf;QACA,IAAIA,IAAI,KAAK,MAAb,EACI,OAAKC,SAAL;;QACJ,OAAKlC,IAAL,CAAUiC,IAAI,KAAK,OAAT,GAAmB,QAAnB,GAA8BA,IAAxC,EAA8ClC,CAA9C;MACH,CALD;;MAMA,OAAKoC,WAAL;;MAlC2B;IAmC9B;;;;aACD,uBAAc;QACV,KAAKP,QAAL,CAAcQ,gBAAd,CAA+B,OAA/B,EAAwC,KAAKJ,aAA7C;QACA,KAAKJ,QAAL,CAAcQ,gBAAd,CAA+B,MAA/B,EAAuC,KAAKJ,aAA5C;QACA,KAAKJ,QAAL,CAAcQ,gBAAd,CAA+B,OAA/B,EAAwC,KAAKJ,aAA7C;MACH;MACL;AACA;AACA;AACA;;;;aACI,aAAIK,MAAJ,EAAY;QACR,IAAI,OAAOA,MAAM,CAACC,OAAd,KAA0B,UAA9B,EAA0C;UACtCD,MAAM,CAACC,OAAP,CAAe,IAAf;QACH;MACJ;MACL;AACA;AACA;AACA;;;;aACI,gBAAO5C,EAAP,EAAW;QACP,IAAI,OAAOA,EAAP,KAAc,UAAlB,EACIA,EAAE,CAACpG,IAAH,CAAQ,IAAR;MACP;;;aACD,iBAAQiJ,IAAR,EAAc;QACV,KAAKX,QAAL,CAAc/F,SAAd,GAA0B,EAA1B;QACA,KAAK2G,MAAL,CAAYD,IAAZ;;QACA,KAAKL,SAAL;MACH;;;aACD,mBAAU;QACN,OAAO,KAAKN,QAAL,CAAc/F,SAAd,CAAwB/C,OAAxB,CAAgC,2BAAhC,EAA6D,EAA7D,CAAP;MACH;MACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;aACI,gBAAO4D,KAAP,EAAc;QAAA;;QACV,IAAIA,KAAK,YAAYlB,WAArB,EAAkC;UAC9B,KAAKiH,OAAL,CAAa/F,KAAb;QACH,CAFD,MAGK;UACD,IAAMZ,EAAE,GAAGJ,aAAa,CAAC,KAAD,CAAxB;UACAI,EAAE,CAACD,SAAH,GAAea,KAAf;UACAzD,KAAK,CAAC6C,EAAE,CAAC+B,UAAJ,CAAL,CAAqB0C,OAArB,CAA6B,UAACmC,IAAD,EAAU;YACnC,IAAIA,IAAI,CAACC,QAAL,KAAkBC,IAAI,CAACC,YAA3B,EAAyC;cACrC,IAAIH,IAAI,CAACxF,QAAL,KAAkBhC,YAAtB,EAAoC;gBAChC,MAAI,CAACuH,OAAL,CAAa/G,aAAa,CAACT,iBAAD,EAAoB,EAApB,EAAwB,OAAxB,CAA1B;cACH,CAFD,MAGK;gBACD,MAAI,CAACwH,OAAL,CAAaC,IAAb;cACH;YACJ,CAPD,MAQK,IAAIA,IAAI,CAAChE,WAAT,EAAsB;cACvB,MAAI,CAAC+D,OAAL,CAAa/G,aAAa,CAACT,iBAAD,EAAoB,EAApB,EAAwByH,IAAI,CAAChE,WAA7B,CAA1B;YACH;UACJ,CAZD;QAaH;MACJ;;;aACD,iBAAQhC,KAAR,EAAe;QACXgF,OAAO,CAACC,GAAR,CAAYjF,KAAZ;QACA,IAAMoG,cAAc,GAAG,KAAKf,MAAL,CAAYgB,cAAZ,EAAvB;;QACA,IAAID,cAAJ,EAAoB;UAChB,IAAInF,WAAW,CAACmF,cAAD,CAAf,EAAiC;YAC7B,KAAKlB,QAAL,CAAcoB,YAAd,CAA2BtG,KAA3B,EAAkCoG,cAAlC;UACH,CAFD,MAGK;YACD,KAAKlB,QAAL,CAAcoB,YAAd,CAA2BtG,KAA3B,EAAkCoG,cAAc,CAACG,kBAAjD;UACH;QACJ,CAPD,MAQK;UACD,KAAKrB,QAAL,CAAcnE,MAAd,CAAqBf,KAArB;QACH;;QACDM,cAAc,CAACN,KAAD,EAAQzB,iBAAR,CAAd;MACH;;;aACD,qBAAY;QACR,IAAI,CAAC0C,WAAW,CAAC,KAAKiE,QAAL,CAAcpD,gBAAf,CAAhB,EAAkD;UAC9C,KAAKoD,QAAL,CAAcsB,WAAd,CAA0BxH,aAAa,CAAC,SAAD,EAAY,EAAZ,EAAgB,MAAhB,CAAvC;QACH;MACJ;;;aACD,mBAAU;QACN,KAAKkG,QAAL,CAAcuB,mBAAd,CAAkC,OAAlC,EAA2C,KAAKnB,aAAhD;QACA,KAAKJ,QAAL,CAAcuB,mBAAd,CAAkC,MAAlC,EAA0C,KAAKnB,aAA/C;QACA,KAAKJ,QAAL,CAAcuB,mBAAd,CAAkC,OAAlC,EAA2C,KAAKnB,aAAhD;QACA,KAAKoB,mBAAL;MACH;;;;IAvIkB7D"}